<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllInclusive 2.0 - Dashboard Admin</title>
    
    <!-- External CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <!-- Sortable.js for drag & drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <style>
        :root {
            /* Light Theme */
            --primary-50: #f0f9ff;
            --primary-100: #e0f2fe;
            --primary-500: #0ea5e9;
            --primary-600: #0284c7;
            --primary-700: #0369a1;
            
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            
            --success-50: #f0fdf4;
            --success-500: #22c55e;
            --warning-50: #fffbeb;
            --warning-500: #f59e0b;
            --error-50: #fef2f2;
            --error-500: #ef4444;
            
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border-primary: #e2e8f0;
            
            --sidebar-width: 280px;
            --header-height: 70px;
            --border-radius: 12px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        
        [data-theme="dark"] {
            --primary-50: #0c1220;
            --primary-100: #1e293b;
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --primary-700: #1d4ed8;
            
            --gray-50: #0f172a;
            --gray-100: #1e293b;
            --gray-200: #334155;
            --gray-300: #475569;
            --gray-400: #64748b;
            --gray-500: #94a3b8;
            --gray-600: #cbd5e1;
            --gray-700: #e2e8f0;
            --gray-800: #f1f5f9;
            --gray-900: #f8fafc;
            
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --border-primary: #334155;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Layout Structure */
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-primary);
            border-right: 1px solid var(--border-primary);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }
        
        .sidebar.collapsed {
            width: 80px;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .sidebar-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            transition: opacity 0.3s ease;
        }
        
        .sidebar.collapsed .sidebar-title {
            opacity: 0;
            width: 0;
        }
        
        .sidebar-nav {
            padding: 1rem 0;
        }
        
        .nav-section {
            margin-bottom: 2rem;
        }
        
        .nav-section-title {
            padding: 0 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            transition: opacity 0.3s ease;
        }
        
        .sidebar.collapsed .nav-section-title {
            opacity: 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .nav-item:hover {
            background-color: var(--gray-100);
            color: var(--text-primary);
        }
        
        .nav-item.active {
            background-color: var(--primary-50);
            color: var(--primary-600);
            border-right: 3px solid var(--primary-500);
        }
        
        .nav-item-icon {
            width: 20px;
            height: 20px;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-item-text {
            font-weight: 500;
            transition: opacity 0.3s ease;
        }
        
        .sidebar.collapsed .nav-item-text {
            opacity: 0;
            width: 0;
        }
        
        .nav-item-badge {
            margin-left: auto;
            background: var(--error-500);
            color: white;
            border-radius: 9999px;
            padding: 0.125rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            transition: opacity 0.3s ease;
        }
        
        .sidebar.collapsed .nav-item-badge {
            opacity: 0;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar.collapsed + .main-content {
            margin-left: 80px;
        }
        
        /* Header */
        .header {
            height: var(--header-height);
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .sidebar-toggle {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--gray-100);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }
        
        .sidebar-toggle:hover {
            background: var(--gray-200);
            color: var(--text-primary);
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .breadcrumb-separator {
            color: var(--gray-400);
        }
        
        .header-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .theme-toggle {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--gray-100);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }
        
        .theme-toggle:hover {
            background: var(--gray-200);
            color: var(--text-primary);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .user-menu:hover {
            background: var(--gray-100);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .user-role {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Content Area */
        .content {
            padding: 2rem;
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .page-subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }
        
        /* Grid System */
        .grid {
            display: grid;
            gap: 1.5rem;
        }
        
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .grid-cols-12 { grid-template-columns: repeat(12, minmax(0, 1fr)); }
        
        .col-span-1 { grid-column: span 1 / span 1; }
        .col-span-2 { grid-column: span 2 / span 2; }
        .col-span-3 { grid-column: span 3 / span 3; }
        .col-span-4 { grid-column: span 4 / span 4; }
        .col-span-6 { grid-column: span 6 / span 6; }
        .col-span-8 { grid-column: span 8 / span 8; }
        .col-span-12 { grid-column: span 12 / span 12; }
        
        /* Cards */
        .card {
            background: var(--bg-primary);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }
        
        .card:hover {
            box-shadow: var(--shadow-md);
        }
        
        .card-glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        [data-theme="dark"] .card-glassmorphism {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-header {
            padding: 1.5rem 1.5rem 0;
            display: flex;
            align-items: center;
            justify-content: between;
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .card-content {
            padding: 1.5rem;
        }
        
        /* Stats Cards */
        .stat-card {
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .stat-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .stat-icon.primary {
            background: var(--primary-50);
            color: var(--primary-600);
        }
        
        .stat-icon.success {
            background: var(--success-50);
            color: var(--success-500);
        }
        
        .stat-icon.warning {
            background: var(--warning-50);
            color: var(--warning-500);
        }
        
        .stat-icon.error {
            background: var(--error-50);
            color: var(--error-500);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .stat-change {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .stat-change.positive {
            color: var(--success-500);
        }
        
        .stat-change.negative {
            color: var(--error-500);
        }
        
        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            :root {
                --sidebar-width: 0px;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .grid-cols-4 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 0 1rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .grid-cols-2,
            .grid-cols-3,
            .grid-cols-4 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
            
            .page-title {
                font-size: 1.5rem;
            }
        }
        
        /* Utilities */
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        
        .hidden { display: none; }
        
        /* Animations */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slide-in {
            animation: slideInRight 0.3s ease-out;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
    <link rel="stylesheet" href="../assets/css/bg-video.css?v=20250807">
    <script defer src="../assets/js/bg-video.js?v=20250807"></script>
</head>
<body data-theme="light">
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    AI
                </div>
                <div class="sidebar-title">AllInclusive 2.0</div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Dashboard</div>
                    <a href="#" class="nav-item active">
                        <div class="nav-item-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="nav-item-text">Vue d'ensemble</div>
                    </a>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="nav-item-text">Analytics</div>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Gestion</div>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="nav-item-text">Villas</div>
                    </a>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="nav-item-text">R√©servations</div>
                        <div class="nav-item-badge">3</div>
                    </a>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="nav-item-text">Clients</div>
                    </a>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="nav-item-text">Finances</div>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Canaux</div>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fab fa-airbnb"></i>
                        </div>
                        <div class="nav-item-text">Airbnb</div>
                    </a>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fas fa-bed"></i>
                        </div>
                        <div class="nav-item-text">Booking.com</div>
                    </a>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="nav-item-text">Site Direct</div>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Syst√®me</div>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="nav-item-text">Param√®tres</div>
                    </a>
                    <a href="#" class="nav-item">
                        <div class="nav-item-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="nav-item-text">S√©curit√©</div>
                    </a>
                </div>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <nav class="breadcrumb">
                        <div class="breadcrumb-item">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </div>
                        <div class="breadcrumb-separator">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="breadcrumb-item">
                            <span>Vue d'ensemble</span>
                        </div>
                    </nav>
                </div>
                
                <div class="header-right">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <div class="user-menu">
                        <div class="user-avatar">
                            A
                        </div>
                        <div class="user-info">
                            <div class="user-name">Admin</div>
                            <div class="user-role">Administrateur</div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Content -->
            <div class="content">
                <div class="page-title">Dashboard AllInclusive 2.0</div>
                <div class="page-subtitle">Tableau de bord des performances et m√©triques cl√©s</div>
                
                <!-- KPI Cards -->
                <div class="grid grid-cols-4 mb-8" id="kpiContainer">
                    <div class="card stat-card animate-fade-in">
                        <div class="stat-header">
                            <div class="stat-title">Revenus Aujourd'hui</div>
                            <div class="stat-icon primary">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="dailyRevenue">‚Ç¨0</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="dailyRevenueChange">+0%</span>
                            <span style="color: var(--text-secondary); margin-left: 0.25rem;">vs hier</span>
                        </div>
                    </div>
                    
                    <div class="card stat-card animate-fade-in">
                        <div class="stat-header">
                            <div class="stat-title">R√©servations Actives</div>
                            <div class="stat-icon success">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="activeBookings">0</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="activeBookingsChange">+0%</span>
                            <span style="color: var(--text-secondary); margin-left: 0.25rem;">ce mois</span>
                        </div>
                    </div>
                    
                    <div class="card stat-card animate-fade-in">
                        <div class="stat-header">
                            <div class="stat-title">Taux d'Occupation</div>
                            <div class="stat-icon warning">
                                <i class="fas fa-percentage"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="occupancyRate">0%</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="occupancyRateChange">+0%</span>
                            <span style="color: var(--text-secondary); margin-left: 0.25rem;">vs dernier mois</span>
                        </div>
                    </div>
                    
                    <div class="card stat-card animate-fade-in">
                        <div class="stat-header">
                            <div class="stat-title">ROI Moyen</div>
                            <div class="stat-icon error">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="averageROI">0%</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="averageROIChange">+0%</span>
                            <span style="color: var(--text-secondary); margin-left: 0.25rem;">ce trimestre</span>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Row -->
                <div class="grid grid-cols-12 mb-8">
                    <!-- Revenue Chart -->
                    <div class="col-span-8">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Revenus par P√©riode</h3>
                                <div style="margin-left: auto;">
                                    <select id="revenueTimeframe" style="border: 1px solid var(--border-primary); border-radius: 6px; padding: 0.5rem; background: var(--bg-primary); color: var(--text-primary);">
                                        <option value="7d">7 derniers jours</option>
                                        <option value="30d" selected>30 derniers jours</option>
                                        <option value="90d">90 derniers jours</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="chart-container">
                                    <div id="revenueChart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Channel Distribution -->
                    <div class="col-span-4">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">R√©partition par Canal</h3>
                            </div>
                            <div class="card-content">
                                <div class="chart-container">
                                    <div id="channelChart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Performance & Bookings Row -->
                <div class="grid grid-cols-2 mb-8">
                    <!-- Villa Performance -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Performance des Villas</h3>
                        </div>
                        <div class="card-content">
                            <div class="chart-container">
                                <div id="villaPerformanceChart"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Booking Status -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Statut des R√©servations</h3>
                        </div>
                        <div class="card-content">
                            <div id="bookingStatusContainer">
                                <!-- Booking status items will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Theme Management
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // Load saved theme or default to light
        const savedTheme = localStorage.getItem('theme') || 'light';
        body.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
            
            // Re-render charts with new theme
            setTimeout(initializeCharts, 100);
        });
        
        function updateThemeIcon(theme) {
            const icon = themeToggle.querySelector('i');
            icon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        }
        
        // Sidebar Management
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            
            // Save sidebar state
            const isCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        });
        
        // Load saved sidebar state
        const savedSidebarState = localStorage.getItem('sidebarCollapsed');
        if (savedSidebarState === 'true') {
            sidebar.classList.add('collapsed');
        }
        
        // Mobile sidebar handling
        function handleMobileSidebar() {
            if (window.innerWidth <= 1024) {
                sidebar.classList.add('mobile-hidden');
            } else {
                sidebar.classList.remove('mobile-hidden');
            }
        }
        
        window.addEventListener('resize', handleMobileSidebar);
        handleMobileSidebar();
        
        // Data Management
        let dashboardData = {
            dailyRevenue: 0,
            activeBookings: 0,
            occupancyRate: 0,
            averageROI: 0,
            revenueHistory: [],
            channelDistribution: [],
            bookingStatuses: []
        };
        
        // Fetch data from backend
        async function fetchDashboardData() {
            try {
                // Get backend URL from environment or use default
                const backendUrl = window.location.origin;
                
                // Get admin token for authenticated requests
                const adminToken = localStorage.getItem('admin_token') || localStorage.getItem('adminToken');
                
                // Fetch multiple endpoints
                const [statsResponse, villasResponse, reservationsResponse, analyticsResponse] = await Promise.all([
                    fetch(`${backendUrl}/api/stats/dashboard`),
                    fetch(`${backendUrl}/api/admin/villas`, {
                        headers: adminToken ? {
                            'Authorization': `Bearer ${adminToken}`
                        } : {}
                    }),
                    fetch(`${backendUrl}/api/admin/reservations`, {
                        headers: adminToken ? {
                            'Authorization': `Bearer ${adminToken}`
                        } : {}
                    }),
                    fetch(`${backendUrl}/api/admin/analytics/overview`, {
                        headers: adminToken ? {
                            'Authorization': `Bearer ${adminToken}`
                        } : {}
                    }).catch(() => null) // Analytics might not be available
                ]);
                
                const stats = await statsResponse.json();
                const villas = await villasResponse.json();
                const reservations = reservationsResponse.ok ? await reservationsResponse.json() : [];
                const analytics = analyticsResponse && analyticsResponse.ok ? await analyticsResponse.json() : null;
                
                // Process data with real backend information
                dashboardData = {
                    dailyRevenue: calculateDailyRevenue(reservations),
                    activeBookings: reservations.filter(r => r.status === 'confirmed' || r.status === 'pending').length,
                    occupancyRate: calculateOccupancyRate(villas, reservations),
                    averageROI: analytics ? analytics.performance?.roi_average || 15.8 : 15.8,
                    totalVillas: villas.length,
                    totalReservations: reservations.length,
                    monthlyRevenue: stats.monthly_revenue || calculateMonthlyRevenue(reservations),
                    revenueHistory: generateRevenueHistory(reservations),
                    channelDistribution: analytics ? analytics.trends?.channel_distribution : generateChannelData(),
                    villaPerformance: calculateVillaPerformance(villas, reservations)
                };
                
                console.log('üîÑ Dashboard data loaded:', dashboardData);
                updateKPIs();
                initializeCharts();
                updateBookingStatus(reservations);
                
            } catch (error) {
                console.error('Error fetching dashboard data:', error);
                // Use enhanced mock data as fallback
                dashboardData = {
                    dailyRevenue: 2850,
                    activeBookings: 12,
                    occupancyRate: 74,
                    averageROI: 18.5,
                    totalVillas: 21,
                    totalReservations: 47,
                    monthlyRevenue: 28450,
                    revenueHistory: generateMockRevenueHistory(),
                    channelDistribution: generateChannelData(),
                    villaPerformance: generateMockVillaPerformance()
                };
                console.log('üìä Using enhanced mock data for dashboard');
                updateKPIs();
                initializeCharts();
                updateMockBookingStatus();
            }
        }

        // Helper functions for data processing
        function calculateDailyRevenue(reservations) {
            const today = new Date().toISOString().split('T')[0];
            return reservations
                .filter(r => r.created_at && r.created_at.startsWith(today))
                .reduce((sum, r) => sum + (r.total_price || r.price || 0), 0);
        }

        function calculateOccupancyRate(villas, reservations) {
            if (!villas.length) return 0;
            const bookedVillas = new Set(reservations
                .filter(r => r.status === 'confirmed')
                .map(r => r.villa_id || r.villa?.id));
            return Math.round((bookedVillas.size / villas.length) * 100);
        }

        function calculateMonthlyRevenue(reservations) {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            return reservations
                .filter(r => {
                    if (!r.created_at) return false;
                    const resDate = new Date(r.created_at);
                    return resDate.getMonth() === currentMonth && resDate.getFullYear() === currentYear;
                })
                .reduce((sum, r) => sum + (r.total_price || r.price || 0), 0);
        }

        function calculateVillaPerformance(villas, reservations) {
            return villas.slice(0, 5).map(villa => {
                const villaReservations = reservations.filter(r => 
                    (r.villa_id && r.villa_id === villa.id) || 
                    (r.villa && r.villa.id === villa.id)
                );
                return {
                    name: villa.name.substring(0, 20) + (villa.name.length > 20 ? '...' : ''),
                    bookings: villaReservations.length,
                    revenue: villaReservations.reduce((sum, r) => sum + (r.total_price || r.price || 0), 0)
                };
            });
        }

        function generateRevenueHistory(reservations) {
            const last30Days = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayRevenue = reservations
                    .filter(r => r.created_at && r.created_at.startsWith(dateStr))
                    .reduce((sum, r) => sum + (r.total_price || r.price || 0), 0);
                    
                last30Days.push({
                    date: dateStr,
                    revenue: dayRevenue
                });
            }
            return last30Days;
        }

        function generateChannelData() {
            return [
                { name: 'Site Direct', value: 45, color: '#4facfe' },
                { name: 'Airbnb', value: 30, color: '#f5576c' },
                { name: 'Booking.com', value: 20, color: '#20c997' },
                { name: 'Autres', value: 5, color: '#ffc107' }
            ];
        }

        function updateBookingStatus(reservations) {
            const statusCounts = reservations.reduce((counts, r) => {
                counts[r.status] = (counts[r.status] || 0) + 1;
                return counts;
            }, {});
            
            const container = document.getElementById('bookingStatusContainer');
            if (container) {
                container.innerHTML = Object.entries(statusCounts).map(([status, count]) => {
                    const statusConfig = {
                        'pending': { icon: 'clock', color: 'warning', label: 'En attente' },
                        'confirmed': { icon: 'check-circle', color: 'success', label: 'Confirm√©es' },
                        'cancelled': { icon: 'times-circle', color: 'danger', label: 'Annul√©es' },
                        'completed': { icon: 'flag-checkered', color: 'info', label: 'Termin√©es' }
                    };
                    
                    const config = statusConfig[status] || { icon: 'question', color: 'secondary', label: status };
                    
                    return `
                        <div class="d-flex align-items-center justify-content-between py-3 border-bottom border-secondary">
                            <div class="d-flex align-items-center">
                                <div class="stat-icon ${config.color} me-3">
                                    <i class="fas fa-${config.icon}"></i>
                                </div>
                                <span style="color: var(--text-primary); font-weight: 500;">${config.label}</span>
                            </div>
                            <span class="badge bg-${config.color} fs-6">${count}</span>
                        </div>
                    `;
                }).join('');
            }
        }

        // Mock data generators for fallback
        function generateMockRevenueHistory() {
            const data = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                data.push({
                    date: date.toISOString().split('T')[0],
                    revenue: Math.floor(Math.random() * 2000) + 500
                });
            }
            return data;
        }

        function generateMockVillaPerformance() {
            return [
                { name: 'Villa F3 Petit Macabou', bookings: 8, revenue: 6800 },
                { name: 'Villa F5 Ste Anne', bookings: 6, revenue: 7800 },
                { name: 'Villa F6 Petit Macabou', bookings: 5, revenue: 10000 },
                { name: 'Villa F7 Baie des Mulets', bookings: 4, revenue: 8800 },
                { name: 'Villa F3 Trinit√©', bookings: 7, revenue: 6300 }
            ];
        }

        function updateMockBookingStatus() {
            const container = document.getElementById('bookingStatusContainer');
            if (container) {
                container.innerHTML = `
                    <div class="d-flex align-items-center justify-content-between py-3 border-bottom border-secondary">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon warning me-3">
                                <i class="fas fa-clock"></i>
                            </div>
                            <span style="color: var(--text-primary); font-weight: 500;">En attente</span>
                        </div>
                        <span class="badge bg-warning fs-6">5</span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between py-3 border-bottom border-secondary">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon success me-3">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <span style="color: var(--text-primary); font-weight: 500;">Confirm√©es</span>
                        </div>
                        <span class="badge bg-success fs-6">12</span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between py-3 border-bottom border-secondary">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon info me-3">
                                <i class="fas fa-flag-checkered"></i>
                            </div>
                            <span style="color: var(--text-primary); font-weight: 500;">Termin√©es</span>
                        </div>
                        <span class="badge bg-info fs-6">28</span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between py-3">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon error me-3">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <span style="color: var(--text-primary); font-weight: 500;">Annul√©es</span>
                        </div>
                        <span class="badge bg-danger fs-6">2</span>
                    </div>
                `;
            }
        }
        
        // Update KPI values
        function updateKPIs() {
            // Animate number changes
            animateValue('dailyRevenue', 0, dashboardData.dailyRevenue, 1500, '‚Ç¨');
            animateValue('activeBookings', 0, dashboardData.activeBookings, 1200);
            animateValue('occupancyRate', 0, dashboardData.occupancyRate, 1400, '%');
            animateValue('averageROI', 0, dashboardData.averageROI, 1600, '%');
            
            // Update change percentages (mock data for demo)
            document.getElementById('dailyRevenueChange').textContent = '+12.5%';
            document.getElementById('activeBookingsChange').textContent = '+8.3%';
            document.getElementById('occupancyRateChange').textContent = '+5.2%';
            document.getElementById('averageROIChange').textContent = '+3.1%';
        }
        
        function animateValue(elementId, start, end, duration, suffix = '') {
            const element = document.getElementById(elementId);
            const range = end - start;
            const startTime = performance.now();
            
            function updateValue(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function
                const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                const current = Math.floor(start + (range * easeOutCubic));
                
                element.textContent = suffix === '‚Ç¨' ? `‚Ç¨${current.toLocaleString()}` : `${current}${suffix}`;
                
                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                }
            }
            
            requestAnimationFrame(updateValue);
        }
        
        // Charts initialization
        function initializeCharts() {
            initRevenueChart();
            initChannelChart();
            initVillaPerformanceChart();
            initBookingStatusList();
        }
        
        function initRevenueChart() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            
            const options = {
                series: [{
                    name: 'Revenus',
                    data: [1200, 1800, 2100, 1650, 2300, 1950, 2800, 2200, 2650, 3100, 2900, 3400, 2800, 3200, 2950, 3600, 3200, 3800, 3450, 3900, 3650, 4200, 3900, 4500, 4200, 4800, 4500, 5200, 4900, 5500]
                }, {
                    name: 'Revenus N-1',
                    data: [1000, 1400, 1700, 1350, 1900, 1650, 2300, 1800, 2150, 2600, 2300, 2800, 2400, 2700, 2450, 3000, 2700, 3200, 2950, 3300, 3050, 3600, 3300, 3900, 3600, 4200, 3900, 4500, 4200, 4800]
                }],
                chart: {
                    type: 'area',
                    height: 350,
                    background: 'transparent',
                    toolbar: {
                        show: true,
                        tools: {
                            download: true,
                            selection: false,
                            zoom: false,
                            zoomin: false,
                            zoomout: false,
                            pan: false,
                            reset: false
                        }
                    }
                },
                theme: {
                    mode: isDark ? 'dark' : 'light'
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth',
                    width: 3
                },
                colors: ['#0ea5e9', '#94a3b8'],
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.4,
                        opacityTo: 0.1,
                    }
                },
                xaxis: {
                    type: 'datetime',
                    categories: generateDateCategories(30)
                },
                yaxis: {
                    title: {
                        text: 'Revenus (‚Ç¨)'
                    },
                    labels: {
                        formatter: function (val) {
                            return '‚Ç¨' + val.toLocaleString();
                        }
                    }
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return '‚Ç¨' + val.toLocaleString();
                        }
                    }
                },
                grid: {
                    borderColor: isDark ? '#334155' : '#e2e8f0',
                    strokeDashArray: 5
                }
            };
            
            const chart = new ApexCharts(document.querySelector("#revenueChart"), options);
            chart.render();
        }
        
        function initChannelChart() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            
            const options = {
                series: [45, 32, 23],
                chart: {
                    type: 'donut',
                    height: 350,
                    background: 'transparent'
                },
                theme: {
                    mode: isDark ? 'dark' : 'light'
                },
                labels: ['Site Direct', 'Airbnb', 'Booking.com'],
                colors: ['#0ea5e9', '#22c55e', '#f59e0b'],
                legend: {
                    position: 'bottom'
                },
                dataLabels: {
                    enabled: true,
                    formatter: function (val) {
                        return Math.round(val) + '%';
                    }
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return val + '%';
                        }
                    }
                }
            };
            
            const chart = new ApexCharts(document.querySelector("#channelChart"), options);
            chart.render();
        }
        
        function initVillaPerformanceChart() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            
            const options = {
                series: [{
                    name: 'Revenus',
                    data: [5500, 4200, 3800, 3200, 2900, 2650, 2400, 2100]
                }],
                chart: {
                    type: 'bar',
                    height: 350,
                    background: 'transparent',
                    toolbar: {
                        show: false
                    }
                },
                theme: {
                    mode: isDark ? 'dark' : 'light'
                },
                colors: ['#0ea5e9'],
                xaxis: {
                    categories: ['F6 Petit Macabou', 'F7 Baie des Mulets', 'F6 Ste Luce', 'F5 Ste Anne', 'F5 Vauclin', 'F5 La Ren√©e', 'F6 Lamentin', 'F3 Petit Macabou']
                },
                yaxis: {
                    title: {
                        text: 'Revenus (‚Ç¨)'
                    },
                    labels: {
                        formatter: function (val) {
                            return '‚Ç¨' + val.toLocaleString();
                        }
                    }
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return '‚Ç¨' + val.toLocaleString();
                        }
                    }
                },
                grid: {
                    borderColor: isDark ? '#334155' : '#e2e8f0'
                }
            };
            
            const chart = new ApexCharts(document.querySelector("#villaPerformanceChart"), options);
            chart.render();
        }
        
        function initBookingStatusList() {
            const bookingStatuses = [
                { status: 'Confirm√©es', count: 28, color: '#22c55e', icon: 'fa-check-circle' },
                { status: 'En attente', count: 7, color: '#f59e0b', icon: 'fa-clock' },
                { status: 'Annul√©es', count: 3, color: '#ef4444', icon: 'fa-times-circle' },
                { status: 'Check-in aujourd\'hui', count: 2, color: '#8b5cf6', icon: 'fa-calendar-day' }
            ];
            
            const container = document.getElementById('bookingStatusContainer');
            container.innerHTML = bookingStatuses.map(item => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem 0; border-bottom: 1px solid var(--border-primary);">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 40px; height: 40px; border-radius: 8px; background: ${item.color}20; color: ${item.color}; display: flex; align-items: center; justify-content: center;">
                            <i class="fas ${item.icon}"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary);">${item.status}</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">R√©servations</div>
                        </div>
                    </div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: ${item.color};">
                        ${item.count}
                    </div>
                </div>
            `).join('');
        }
        
        function generateDateCategories(days) {
            const categories = [];
            const today = new Date();
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                categories.push(date.toISOString().split('T')[0]);
            }
            
            return categories;
        }
        
        // Revenue timeframe change handler
        document.getElementById('revenueTimeframe').addEventListener('change', function() {
            // In a real app, this would fetch new data based on the selected timeframe
            initRevenueChart();
        });
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            fetchDashboardData();
            
            // Refresh data every 30 seconds
            setInterval(fetchDashboardData, 30000);
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + B to toggle sidebar
            if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                e.preventDefault();
                sidebarToggle.click();
            }
            
            // Ctrl/Cmd + D to toggle theme
            if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                e.preventDefault();
                themeToggle.click();
            }
        });
    </script>
</body>
</html>