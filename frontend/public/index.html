<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhanelConcept - Plateforme Connectée | Villas de Luxe Martinique</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Découvrez nos villas de luxe en Martinique. Réservation en ligne avec galeries interactives, calendriers avancés et système de réservation professionnel.">
    <meta name="keywords" content="villa martinique, location villa luxe, martinique vacances, villa piscine, séjour martinique">
    <meta name="author" content="KhanelConcept">
    <meta property="og:title" content="KhanelConcept - Villas de Luxe Martinique">
    <meta property="og:description" content="Plateforme moderne de réservation de villas de luxe en Martinique avec interface glassmorphism">
    <meta property="og:type" content="website">
    <link rel="icon" type="image/png" href="https://customer-assets.emergentagent.com/job_luxestay/artifacts/36sqn0fh_IMG_9175.png">
    <link rel="apple-touch-icon" href="https://customer-assets.emergentagent.com/job_luxestay/artifacts/36sqn0fh_IMG_9175.png">
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <!-- Custom CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Video Background avec votre vidéo Cloudinary */
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }
        
        .video-background video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            object-fit: cover;
            filter: brightness(0.7) contrast(1.1) saturate(1.2);
        }
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            object-fit: cover;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: -1;
        }
        
        /* Header Glassmorphism - CORRIGÉ POUR PROFESSIONNEL */
        .header {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header.scrolled {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.15);
        }
        
        /* ===== CORRECTION HEADER SANS CHANGER LE STYLE ===== */
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
            position: relative;
            gap: 1rem;
        }
        
        .logo {
            font-size: 1.6rem;
            font-weight: 700;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1001;
            flex-shrink: 0;
        }
        
        .logo:hover {
            transform: scale(1.05);
        }
        
        .logo-image {
            height: 40px;
            width: auto;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .logo-text {
            color: white;
            font-size: 1.6rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .logo:hover .logo-image {
            transform: rotate(5deg) scale(1.1);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
        }
        
        .logo i {
            color: #FFA500;
            font-size: 1.8rem;
        }
        
        /* Hero Logo Styles */
        .hero-logo {
            text-align: center;
            margin-bottom: 2rem;
            animation: heroLogoEntrance 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            /* Force perfect centering */
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 0;
        }
        
        .hero-logo-image {
            height: 120px;
            width: auto;
            max-width: 400px;
            border-radius: 15px;
            transition: all 0.4s ease;
            filter: drop-shadow(0 10px 30px rgba(212, 175, 55, 0.3));
            /* Perfect centering */
            display: block;
            margin: 0 auto;
        }
        
        .hero-logo:hover .hero-logo-image {
            transform: scale(1.05) translateY(-5px);
            filter: drop-shadow(0 20px 50px rgba(212, 175, 55, 0.5));
        }
        
        @keyframes heroLogoEntrance {
            0% {
                opacity: 0;
                transform: translateY(-30px) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Responsive Hero Logo */
        @media (max-width: 768px) {
            .hero-logo {
                margin-bottom: 2.5rem;
                padding: 0;
                text-align: center;
                /* Ensure perfect centering on mobile */
                display: flex;
                justify-content: center;
                align-items: center;
                width: 100%;
            }
            
            .hero-logo-image {
                height: 90px;
                max-width: 320px;
                display: block;
                margin: 0 auto;
            }
        }
        
        @media (max-width: 480px) {
            .hero-logo {
                margin-bottom: 2rem;
                padding: 0;
                text-align: center;
                /* Perfect centering on small screens */
                display: flex;
                justify-content: center;
                align-items: center;
                width: 100%;
            }
            
            .hero-logo-image {
                height: 70px;
                max-width: 280px;
                display: block;
                margin: 0 auto;
            }
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
            list-style: none;
            align-items: center;
            margin: 0;
            padding: 0;
            flex-wrap: nowrap;
            justify-content: center;
            flex: 1;
            max-width: 800px;
            overflow: visible;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.85rem;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        /* Style spécial pour SOS Dépannage */
        .sos-link {
            background: rgba(255, 68, 68, 0.15) !important;
            border: 1px solid rgba(255, 68, 68, 0.3) !important;
            color: #FFE4E4 !important;
        }
        
        .sos-link:hover {
            background: rgba(255, 68, 68, 0.3) !important;
            border-color: rgba(255, 68, 68, 0.5) !important;
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 68, 68, 0.3);
        }
        
        .sos-link i {
            margin-right: 0.5rem;
            color: #FF4444;
        }
        
        .sos-link:hover i {
            color: white;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.7; }
        }
        
        /* ===== CORRECTION LIENS MEMBRE SANS CHANGER LE STYLE ===== */
        
        .member-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-right: 1rem;
            padding-right: 1rem;
            position: relative;
            flex-shrink: 0;
        }
        
        .member-link {
            background: rgba(255, 255, 255, 0.1) !important;
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white !important;
            text-decoration: none !important;
            padding: 8px 16px !important;
            border-radius: 25px !important;
            font-weight: 600 !important;
            font-size: 0.85rem !important;
            display: flex !important;
            align-items: center !important;
            gap: 6px !important;
            transition: all 0.3s ease !important;
            white-space: nowrap !important;
        }
        
        .member-link:hover {
            background: rgba(255, 255, 255, 0.2) !important;
            border-color: rgba(255, 255, 255, 0.4) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
        }
        
        .login-link {
            background: rgba(135, 206, 235, 0.15) !important;
            border-color: rgba(135, 206, 235, 0.3) !important;
        }
        
        .login-link:hover {
            background: rgba(135, 206, 235, 0.3) !important;
            border-color: rgba(135, 206, 235, 0.5) !important;
        }
        
        .register-link {
            background: rgba(246, 173, 85, 0.15) !important;
            border-color: rgba(246, 173, 85, 0.3) !important;
        }
        
        .register-link:hover {
            background: rgba(246, 173, 85, 0.3) !important;
            border-color: rgba(246, 173, 85, 0.5) !important;
        }
        
        .member-separator {
            width: 1px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            margin-left: 0.5rem;
        }
        
        /* Member Profile Preview Styles */
        .member-profile-preview {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05) !important;
            border: 2px solid rgba(255, 255, 255, 0.15) !important;
            border-radius: 25px !important;
            padding: 6px 12px !important;
            transition: all 0.3s ease !important;
        }
        
        .member-profile-preview:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            border-color: rgba(255, 255, 255, 0.3) !important;
        }
        
        .member-avatar {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #f6ad55 0%, #e69000 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .member-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .member-name {
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
            line-height: 1;
        }
        
        .member-level {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.7rem;
            line-height: 1;
            margin-top: 2px;
        }
        
        .dashboard-link {
            background: rgba(135, 206, 235, 0.2) !important;
            border-color: rgba(135, 206, 235, 0.4) !important;
        }
        
        .dashboard-link:hover {
            background: rgba(135, 206, 235, 0.4) !important;
            border-color: rgba(135, 206, 235, 0.6) !important;
        }
        
        .logout-link {
            background: rgba(245, 101, 101, 0.15) !important;
            border-color: rgba(245, 101, 101, 0.3) !important;
        }
        
        .logout-link:hover {
            background: rgba(245, 101, 101, 0.3) !important;
            border-color: rgba(245, 101, 101, 0.5) !important;
        }
        
        /* Mobile Member Links Styles */
        @media (max-width: 768px) {
            .member-links {
                margin-right: 0 !important;
                padding-right: 0 !important;
                justify-content: center !important;
                width: 100% !important;
                margin-bottom: 1rem !important;
            }
            
            .member-separator {
                display: none !important;
            }
            
            .member-link {
                flex: 1 !important;
                justify-content: center !important;
                min-width: 120px !important;
                max-width: 150px !important;
            }
            
            .member-link span {
                display: inline !important;
            }
        }
        
        @media (max-width: 480px) {
            .member-links {
                flex-direction: column !important;
                gap: 0.75rem !important;
                align-items: stretch !important;
            }
            
            .member-link {
                flex: none !important;
                width: 100% !important;
                max-width: none !important;
            }
        }
        
        /* Main Content - AJUSTÉ POUR HEADER FIXED */
        .main-content {
            padding-top: 70px; /* Compensation pour header fixed */
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }
        
        .section {
            padding: 2rem 0;
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .section h1 {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .section h2 {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            margin: 2rem 0 1rem 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .section p {
            font-size: 1.1rem;
            color: white;
            text-align: center;
            margin-bottom: 2rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        /* Glass Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            height: auto;
            display: flex;
            flex-direction: column;
        }
        
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }
        
        /* Villa Cards */
        .villa-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            height: 560px;
            display: flex;
            flex-direction: column;
        }
        
        .villa-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }
        
        .villa-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 15px 15px 0 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .villa-image:hover {
            transform: scale(1.05);
        }
        
        .villa-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .villa-content h3 {
            color: white;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }
        
        .villa-content p {
            color: rgba(255, 255, 255, 0.9);
            text-align: left;
            margin-bottom: 0.5rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            font-size: 0.9rem;
        }
        
        .price {
            font-size: 1.4rem;
            font-weight: bold;
            color: #FFA500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            margin: 1rem 0;
        }
        
        .villa-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: auto;
        }
        
        .btn-primary, .btn-secondary {
            padding: 8px 16px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            flex: 1;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: #FFA500;
            color: white;
        }
        
        .btn-primary:hover {
            background: #FF8C00;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* ===== CORRECTION POSITIONNEMENT BARRE DE RECHERCHE ===== */
        
        .search-section {
            width: 100%;
            max-width: 1400px;
            margin: 3rem auto;
            padding: 0 2rem;
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .search-section h2 {
            text-align: center;
            font-size: 2.8rem;
            font-weight: 700;
            color: white;
            margin-bottom: 2.5rem;
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.4),
                0 4px 8px rgba(0, 0, 0, 0.3),
                0 8px 16px rgba(0, 0, 0, 0.2);
            letter-spacing: 0.8px;
        }
        
        .villa-search-form {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(35px) saturate(180%);
            -webkit-backdrop-filter: blur(35px) saturate(180%);
            border-radius: 28px;
            padding: 24px;
            display: flex;
            align-items: stretch;
            gap: 3px;
            box-shadow: 
                0 25px 70px rgba(0, 0, 0, 0.25),
                0 10px 40px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.25),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.15);
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            position: relative;
            z-index: 10;
            overflow: visible;
            flex-wrap: nowrap;
        }

        .villa-search-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.15) 0%, 
                rgba(255, 255, 255, 0.05) 30%, 
                rgba(255, 255, 255, 0.1) 70%,
                rgba(255, 255, 255, 0.15) 100%);
            border-radius: 28px;
            pointer-events: none;
            z-index: 1;
        }

        /* CHAMPS DE RECHERCHE HORIZONTAUX CORRIGÉS */
        .search-field {
            padding: 20px 18px;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            border-right: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 150px;
            border-radius: 15px;
            margin: 0 1px;
            z-index: 2;
            flex-shrink: 0;
        }

        .search-field:first-child {
            border-top-left-radius: 20px;
            border-bottom-left-radius: 20px;
        }

        .search-field:last-child {
            border-right: none;
            flex: 0 0 auto;
            min-width: 120px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        .search-field:hover {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            transform: translateY(-2px);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .search-field label {
            font-size: 13px;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
            font-family: 'Inter', sans-serif;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* CHAMP LOCALISATION AVEC AUTOCOMPLETE AMÉLIORÉ */
        .location-field {
            position: relative;
        }

        .location-input {
            border: none;
            background: transparent;
            color: white;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            outline: none;
            width: 100%;
            padding: 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .location-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 400;
        }

        /* DROPDOWN SUGGESTIONS LOCALISATION AMÉLIORÉ */
        .location-suggestions {
            position: absolute;
            top: 100%;
            left: -20px;
            right: -20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border-radius: 20px;
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.25),
                0 8px 32px rgba(102, 126, 234, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            z-index: 1000;
            max-height: 280px;
            overflow-y: auto;
            margin-top: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: none;
        }

        .suggestion-item {
            padding: 18px 28px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            color: #1f2937;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .suggestion-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #1d4ed8;
            transform: translateX(5px);
            backdrop-filter: blur(20px);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        /* CHAMPS DATES AMÉLIORÉS */
        .search-field input:not(.location-input):not(.voyageurs-display) {
            border: none;
            background: transparent;
            color: white;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            outline: none;
            width: 100%;
            padding: 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .search-field input::placeholder {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 400;
        }

        /* SÉLECTEUR VOYAGEURS CORRIGÉ */
        .guests-field {
            position: relative;
            flex: 1.5;
            flex-shrink: 0;
            min-width: 220px;
            overflow: visible;
        }

        .voyageurs-dropdown {
            position: relative;
            width: 100%;
        }

        .voyageurs-display {
            border: none !important;
            background: transparent !important;
            color: white !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            font-family: 'Inter', sans-serif !important;
            outline: none !important;
            width: 100% !important;
            padding: 0 !important;
            cursor: pointer !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
        }

        /* DROPDOWN MENU VOYAGEURS AVEC ANIMATIONS SMOOTH */
        .guests-dropdown {
            position: absolute;
            top: 100%;
            right: -100px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.25),
                0 8px 32px rgba(102, 126, 234, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            z-index: 999999;
            display: none;
            width: 350px;
            min-width: 350px;
            margin-top: 10px;
            opacity: 0;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .guests-dropdown.active {
            display: block;
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        /* Ajustement pour éviter le débordement */
        .guests-field {
            position: relative;
            flex: 1.5;
            flex-shrink: 0;
            min-width: 220px;
            overflow: visible;
        }
        
        /* Repositionner le dropdown si nécessaire pour éviter le débordement */
        @media (max-width: 1400px) {
            .guests-dropdown {
                right: -50px;
            }
        }
        
        @media (max-width: 1200px) {
            .guests-dropdown {
                right: 0;
            }
        }
        
        .guests-dropdown.active {
            display: block;
        }
        
        .guest-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        .guest-row:last-child {
            border-bottom: none;
        }
        
        .guest-info {
            flex: 1;
        }
        
        .guest-type {
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
            font-size: 16px;
        }
        
        .guest-description {
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .guest-counter {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-shrink: 0;
        }
        
        .counter-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #3b82f6;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #3b82f6;
            transition: all 0.3s ease;
            font-size: 18px;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }
        
        .counter-btn:hover {
            background: #3b82f6;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        .counter-btn:disabled {
            border-color: #d1d5db;
            color: #d1d5db;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .counter-btn:disabled:hover {
            background: white;
            color: #d1d5db;
            transform: none;
        }
        
        .counter-value {
            font-weight: 700;
            color: #1f2937;
            min-width: 28px;
            text-align: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        /* BOUTON DE RECHERCHE AMÉLIORÉ */
        .search-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 0 32px;
            border-radius: 18px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            gap: 12px;
            height: 100%;
            min-height: 56px;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 
                0 8px 20px rgba(59, 130, 246, 0.3),
                0 4px 12px rgba(29, 78, 216, 0.2);
            position: relative;
            overflow: hidden;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .search-btn:hover::before {
            left: 100%;
        }

        .search-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 15px 35px rgba(59, 130, 246, 0.4),
                0 8px 20px rgba(29, 78, 216, 0.3);
        }

        .search-btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        /* Bouton de recherche spécifique */
        .search-field.search-button-field {
            background: transparent !important;
            border: none !important;
            padding: 12px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .search-field.search-button-field:hover {
            background: transparent !important;
            transform: none !important;
        }

        /* RESPONSIVE DESIGN PROFESSIONNEL - ZÉRO CASSURE */
        @media (min-width: 1025px) {
            .villa-search-form {
                flex-wrap: nowrap !important;
                gap: 3px !important;
                padding: 24px !important;
            }
            
            .search-field {
                flex: 1 !important;
                min-width: 150px !important;
                margin: 0 1px !important;
                border-right: 2px solid rgba(255, 255, 255, 0.1) !important;
                border-bottom: none !important;
                border-radius: 15px !important;
            }
            
            .search-field:first-child {
                border-top-left-radius: 20px !important;
                border-bottom-left-radius: 20px !important;
            }
            
            .search-field:last-child {
                border-right: none !important;
                flex: 0 0 auto !important;
                min-width: 120px !important;
                border-top-right-radius: 20px !important;
                border-bottom-right-radius: 20px !important;
            }
        }
        
        @media (max-width: 1200px) {
            .header-content {
                padding: 1rem 1.5rem;
            }
            
            .search-section {
                padding: 0 1.5rem;
            }
            
            .villa-search-form {
                max-width: 100%;
                overflow: visible;
            }
            
            .search-field {
                min-width: 140px;
                padding: 18px 16px;
            }
        }

        /* RESPONSIVE DESIGN MOBILE - CORRECTION */
        @media (max-width: 768px) {
            .header-content {
                padding: 1rem;
                height: 60px;
                gap: 0.5rem;
            }
            
            .main-content {
                padding-top: 60px;
            }
            
            .logo {
                font-size: 1.4rem;
            }
            
            .search-section {
                padding: 0 1rem;
                margin: 2rem 0;
            }
            
            .search-section h2 {
                font-size: 2.2rem;
                margin-bottom: 2rem;
            }
            
            .villa-search-form {
                flex-direction: column;
                padding: 24px;
                max-width: 100%;
                width: calc(100% - 2rem);
                border-radius: 24px;
            }
            
            .search-field {
                border: none;
                border-bottom: 2px solid rgba(255, 255, 255, 0.15);
                min-width: auto;
                padding: 20px 0;
                margin: 0;
                border-radius: 0;
                width: 100%;
            }
            
            .search-field:first-child {
                border-radius: 18px 18px 0 0;
            }
            
            .search-field:last-child {
                border-bottom: none;
                padding-top: 28px;
                border-radius: 0 0 18px 18px;
            }
            
            .search-btn {
                width: 100%;
                justify-content: center;
                min-height: 56px;
                font-size: 16px;
            }
            
            .member-links {
                margin-right: 0;
                padding-right: 0;
                gap: 0.3rem;
            }
            
            .member-link {
                padding: 6px 12px !important;
                font-size: 0.75rem !important;
            }
            
            .member-separator {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .header-content {
                padding: 0.8rem;
            }
            
            .search-section {
                padding: 0 0.8rem;
            }
            
            .search-section h2 {
                font-size: 1.8rem;
            }
            
            .villa-search-form {
                width: calc(100% - 1.6rem);
                padding: 24px;
            }
            
            .search-field {
                padding: 20px 0;
            }
        }
        
        /* CORRECTIONS Z-INDEX GLOBALES */
        .header {
            z-index: 1000;
        }
        
        .mobile-nav-toggle {
            z-index: 1001;
        }
        
        .nav-links.nav-menu.mobile-open {
            z-index: 1002;
        }
        
        .location-suggestions {
            z-index: 1003;
        }
        
        .guests-dropdown {
            z-index: 1004;
        }
        
        /* Bouton de recherche spécifique */
        .search-field.search-button-field {
            background: transparent !important;
            border: none !important;
            padding: 8px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .search-field.search-button-field:hover {
            background: transparent !important;
        }
        
        .search-field {
            padding: 16px 20px;
            border: none;
            background: transparent;
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 200px;
            flex: 1;
        }
        
        .search-field:last-of-type {
            border-right: none;
        }
        
        .search-field:hover {
            background: rgba(0, 0, 0, 0.02);
        }
        
        .search-field-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .search-field input, .search-field select {
            border: none;
            background: transparent;
            font-size: 14px;
            color: #666;
            font-weight: 500;
            width: 100%;
            outline: none;
        }
        
        .search-button {
            background: linear-gradient(135deg, #0071c2 0%, #004d8b 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-left: 8px;
            flex-shrink: 0;
            min-width: 120px;
        }
        
        .search-button:hover {
            background: linear-gradient(135deg, #005999 0%, #003d6b 100%);
            transform: translateY(-1px);
        }
        
        /* Villa Grid */
        .villas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active, .filter-btn:hover {
            background: #FFA500;
            border-color: #FFA500;
        }
        
        /* Image Placeholder */
        .image-placeholder {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            border-radius: 15px 15px 0 0;
            cursor: pointer;
        }
        
        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            margin: 15% auto;
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #FFA500;
        }
        
        .price-summary {
            background: rgba(255, 165, 0, 0.1);
            border: 2px solid #FFA500;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .price-summary h3 {
            color: #333;
            margin-bottom: 1rem;
        }
        
        .price-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .price-total {
            font-weight: bold;
            font-size: 1.2rem;
            border-top: 2px solid #FFA500;
            padding-top: 0.5rem;
            margin-top: 1rem;
        }
        
        /* Gallery Modal */
        .image-gallery-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
        }
        
        .image-gallery-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gallery-content {
            position: relative;
            width: 90%;
            height: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gallery-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .gallery-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: none;
            color: white;
            font-size: 2rem;
            padding: 1rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .gallery-nav:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }
        
        .gallery-prev {
            left: 20px;
        }
        
        .gallery-next {
            right: 20px;
        }
        
        .gallery-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .gallery-thumbnails {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
            overflow-x: auto;
        }
        
        .thumbnail {
            width: 60px;
            height: 40px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }
        
        .thumbnail.active, .thumbnail:hover {
            opacity: 1;
        }
        
        /* Status Messages */
        .status-message {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: rgba(34, 197, 94, 1);
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .loading {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: rgba(59, 130, 246, 1);
        }
        
        .error {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: rgba(239, 68, 68, 1);
        }
        
        /* ANIMATIONS SCROLL-TRIGGERED POUR LES VILLAS */
        
        /* Défilement fluide pour toute la page */
        html {
            scroll-behavior: smooth;
        }
        
        /* Villas invisibles au début */
        .villa-card {
            opacity: 0 !important;
            transform: translateY(60px) scale(0.95) !important;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
            will-change: opacity, transform;
        }
        
        /* Villas visibles lors du scroll */
        .villa-card.visible {
            opacity: 1 !important;
            transform: translateY(0) scale(1) !important;
        }
        
        .villa-card.visible:hover {
            transform: translateY(-8px) scale(1.02) !important;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25) !important;
        }
        
        /* Animation progressive avec délais */
        .villa-card.visible:nth-child(1) { transition-delay: 0.1s; }
        .villa-card.visible:nth-child(2) { transition-delay: 0.2s; }
        .villa-card.visible:nth-child(3) { transition-delay: 0.3s; }
        .villa-card.visible:nth-child(4) { transition-delay: 0.4s; }
        .villa-card.visible:nth-child(5) { transition-delay: 0.5s; }
        .villa-card.visible:nth-child(6) { transition-delay: 0.6s; }
        
        /* Animation des boutons dans les villas */
        .villa-buttons .btn-primary,
        .villa-buttons .btn-secondary {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .villa-buttons .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 165, 0, 0.4);
        }
        
        .villa-buttons .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 255, 255, 0.2);
        }
        
        /* Animation pour les images des villas */
        .villa-image {
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .villa-image:hover {
            transform: scale(1.08);
            filter: brightness(1.1) contrast(1.1);
        }
        
        /* Animation des filtres */
        .filter-btn {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 165, 0, 0.3);
        }
        
        /* Animation pour les counters du dropdown */
        .counter-btn {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .counter-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        .counter-btn:active {
            transform: scale(0.95);
        }
        
        /* Animation pour les champs de recherche */
        .search-field {
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .search-field:hover {
            transform: translateY(-3px);
        }
        
        /* Animation pour la barre de recherche complète */
        .villa-search-form {
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .villa-search-form:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.3),
                0 15px 50px rgba(102, 126, 234, 0.25);
        }
        
        /* Animation des autres éléments au scroll */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* ===========================================
           OPTIMISATIONS MOBILE RESPONSIVE
           ========================================= */
        
        /* Mobile nav hamburger - Force l'affichage correct */
        .mobile-nav-toggle {
            display: none;
        }
        
        @media (max-width: 768px) {
            .mobile-nav-toggle {
                display: block !important;
                background: none;
                border: none;
                color: white;
                font-size: 1.5rem;
                padding: 0.5rem;
                cursor: pointer;
                z-index: 1001;
            }
            
            .nav-menu {
                display: none !important;
            }
            
            .nav-menu.mobile-open {
                display: flex !important;
                position: fixed;
                top: 60px;
                left: 0;
                right: 0;
                background: rgba(0, 0, 0, 0.7) !important;
                backdrop-filter: blur(25px);
                padding: 2rem 1rem;
                border-radius: 0 0 20px 20px;
                flex-direction: column;
                gap: 1.5rem;
                z-index: 1000;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            }
            
            .nav-menu.mobile-open a {
                color: white !important;
                font-size: 1.1rem;
                font-weight: 500;
                padding: 12px 20px;
                border-radius: 10px;
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                transition: all 0.3s ease;
                text-decoration: none;
                text-align: center;
            }
            
            .nav-menu.mobile-open a:hover,
            .nav-menu.mobile-open a:active {
                background: rgba(255, 255, 255, 0.2) !important;
                transform: scale(1.02);
            }
            
            .header-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.75rem 0;
            }
        }
        
        /* Formulaire de recherche mobile COMPLET */
        @media (max-width: 768px) {
            .search-section {
                padding: 1.5rem !important;
            }
            
            .search-form {
                padding: 1.5rem !important;
            }
            
            .search-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            .search-group input,
            .search-group select,
            .search-field input {
                height: 50px !important;
                font-size: 16px !important;
                padding: 0 1rem !important;
            }
            
            .btn-primary {
                height: 50px !important;
                font-size: 1rem !important;
                padding: 0 2rem !important;
            }
            
            /* DROPDOWN VOYAGEURS - CORRECTION POSITION MOBILE */
            .guests-field {
                position: relative !important;
                z-index: 100 !important;
            }
            
            .voyageurs-dropdown {
                position: relative !important;
                width: 100% !important;
            }
            
            .dropdown-menu.guests-dropdown {
                position: absolute !important;
                top: 100% !important;
                left: 0 !important;
                right: 0 !important;
                background: rgba(255, 255, 255, 0.95) !important;
                backdrop-filter: blur(20px) !important;
                border-radius: 15px !important;
                padding: 1rem !important;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
                z-index: 1000 !important;
                max-width: none !important;
                width: 100% !important;
                margin-top: 5px !important;
            }
            
            .guest-row {
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                padding: 0.75rem 0 !important;
                border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
            }
            
            .guest-row:last-child {
                border-bottom: none !important;
            }
            
            .guest-info {
                flex: 1 !important;
            }
            
            .guest-type {
                font-weight: 600 !important;
                color: #333 !important;
                font-size: 1rem !important;
            }
            
            .guest-description {
                font-size: 0.85rem !important;
                color: #666 !important;
            }
            
            .guest-counter {
                display: flex !important;
                align-items: center !important;
                gap: 15px !important;
            }
            
            .counter-btn {
                width: 40px !important;
                height: 40px !important;
                border-radius: 50% !important;
                border: 2px solid #ddd !important;
                background: white !important;
                color: #333 !important;
                font-size: 1.2rem !important;
                font-weight: bold !important;
                cursor: pointer !important;
                transition: all 0.2s ease !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .counter-btn:hover {
                background: #f0f0f0 !important;
                border-color: #ccc !important;
            }
            
            .counter-value {
                font-size: 1.1rem !important;
                font-weight: 600 !important;
                color: #333 !important;
                min-width: 30px !important;
                text-align: center !important;
            }
        }
        
        /* Cartes villas mobile */
        @media (max-width: 768px) {
            .villas-grid {
                grid-template-columns: 1fr !important;
                gap: 1.5rem !important;
                padding: 0 1rem !important;
            }
            
            .villa-card {
                max-width: none !important;
                margin: 0 !important;
            }
            
            .villa-image {
                height: 220px !important;
            }
            
            .villa-info {
                padding: 1.5rem !important;
            }
            
            .villa-name {
                font-size: 1.3rem !important;
                line-height: 1.4 !important;
            }
            
            .villa-location,
            .villa-details,
            .villa-features {
                font-size: 0.95rem !important;
                line-height: 1.5 !important;
            }
            
            .villa-actions {
                gap: 0.75rem !important;
                margin-top: 1.5rem !important;
            }
            
            .villa-actions .btn {
                height: 50px !important;
                font-size: 1rem !important;
                padding: 0 1.5rem !important;
                min-width: 120px !important;
            }
            
            .price-tag {
                font-size: 1.4rem !important;
                padding: 0.75rem 1rem !important;
            }
        }
        
        /* Conteneurs principaux mobile */
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem !important;
            }
            
            .hero-section {
                padding: 2rem 0 !important;
                text-align: center !important;
            }
            
            .hero-title {
                font-size: 2rem !important;
                line-height: 1.3 !important;
                margin-bottom: 1rem !important;
            }
            
            .hero-subtitle {
                font-size: 1.1rem !important;
                line-height: 1.5 !important;
            }
            
            .section-title {
                font-size: 1.8rem !important;
                margin-bottom: 1.5rem !important;
            }
        }
        
        /* Optimisations tactiles */
        @media (max-width: 768px) {
            /* Zones tactiles minimales */
            button, .btn, a[role="button"] {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Espacement entre éléments cliquables */
            .villa-actions .btn + .btn {
                margin-left: 8px;
            }
            
            /* Améliorer contraste pour lecture mobile */
            .villa-card {
                background: rgba(255, 255, 255, 0.12) !important;
            }
            
            .glass-panel {
                background: rgba(255, 255, 255, 0.15) !important;
            }
        }
        
        /* Prévention du zoom iOS sur les inputs */
        @media (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
            }
            
            /* CALENDRIERS INDEX MOBILE */
            .flatpickr-calendar {
                font-size: 16px !important;
                max-width: 90vw !important;
                z-index: 9999 !important;
                position: fixed !important;
                left: 50% !important;
                top: 50% !important;
                transform: translate(-50%, -50%) !important;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3) !important;
                border-radius: 15px !important;
                backdrop-filter: blur(20px);
                background: rgba(255, 255, 255, 0.95) !important;
            }
            
            .flatpickr-day {
                height: 44px !important;
                line-height: 44px !important;
                min-width: 44px !important;
                font-size: 16px !important;
            }
            
            .flatpickr-current-month {
                font-size: 18px !important;
                padding: 10px 0 !important;
            }
            
            .flatpickr-weekday {
                font-size: 14px !important;
                padding: 8px 0 !important;
            }
            
            /* Overlay pour calendrier mobile */
            .flatpickr-calendar.open::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: -1;
            }
            
            /* Champs de date INDEX - tactiles */
            #checkin, #checkout {
                cursor: pointer !important;
                user-select: none !important;
                -webkit-user-select: none !important;
            }
        }
        /* MOBILE LAYOUT - CORRECTION CRITIQUE */
        @media (max-width: 768px) {
            .header-content {
                display: flex !important;
                flex-direction: row !important;
                justify-content: space-between !important;
                align-items: center !important;
                text-align: left !important;
            }
            
            /* MASQUER NAVIGATION DESKTOP */
            .nav-links {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
            }
            
            .nav-links a {
                display: none !important;
            }
        }
            
            .section h1 {
                font-size: 2rem;
            }
            
            .booking-search-container {
                flex-direction: column;
                gap: 0;
            }
            
            .search-field {
                border-right: none;
                border-bottom: 1px solid rgba(0, 0, 0, 0.1);
                min-width: 100%;
            }
            
            .search-field:last-of-type {
                border-bottom: none;
            }
            
            .search-button {
                margin-left: 0;
                margin-top: 12px;
                width: 100%;
            }
            
            .villas-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .villa-card {
                height: auto;
                min-height: 450px;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 1rem;
            }
        }
        
        /* ===========================================
           FORCE MOBILE NAVIGATION - PRIORITÉ ABSOLUE
           ========================================= */
        
        /* Desktop nav visible par défaut */
        .mobile-nav-toggle {
            display: none;
        }
        
        /* MOBILE FORCE OVERRIDE */
        @media screen and (max-width: 768px) {
            /* CRITIQUE : Masquer COMPLÈTEMENT la navigation desktop */
            .header-content > .nav-links,
            .header-content > nav,
            .header-content > .nav-links.nav-menu,
            .header-content nav.nav-links,
            .header-content nav.nav-menu,
            nav[class*="nav-links"],
            nav[class*="nav-menu"],
            .nav-links,
            .nav-menu {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
                position: absolute !important;
                left: -9999px !important;
            }
            
            /* Force hamburger button visible */
            .mobile-nav-toggle {
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                background: rgba(255, 255, 255, 0.1) !important;
                border: 1px solid rgba(255, 255, 255, 0.2) !important;
                border-radius: 8px !important;
                color: white !important;
                font-size: 1.2rem !important;
                cursor: pointer !important;
                padding: 0.5rem !important;
                z-index: 1001 !important;
                transition: all 0.3s ease !important;
            }
            
            .mobile-nav-toggle:hover {
                background: rgba(255, 255, 255, 0.2) !important;
                transform: scale(1.05) !important;
            }
            
            /* Header layout mobile forcé */
            .header-content {
                display: flex !important;
                flex-direction: row !important;
                justify-content: space-between !important;
                align-items: center !important;
                padding: 0.75rem 0 !important;
                text-align: left !important;
            }
            
            /* Show mobile menu when active - GLASSMORPHISM AMÉLIORÉ */
            .nav-links.nav-menu.mobile-open {
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
                position: fixed !important;
                top: 60px !important;
                left: 0 !important;
                right: 0 !important;
                background: rgba(15, 25, 50, 0.85) !important;
                backdrop-filter: blur(40px) saturate(180%) !important;
                -webkit-backdrop-filter: blur(40px) saturate(180%) !important;
                padding: 2.5rem 1.5rem !important;
                border-radius: 0 0 25px 25px !important;
                flex-direction: column !important;
                gap: 1rem !important;
                z-index: 1000 !important;
                box-shadow: 
                    0 20px 60px rgba(0, 0, 0, 0.6),
                    0 8px 32px rgba(102, 126, 234, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                animation: slideDownGlass 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
            }

            @keyframes slideDownGlass {
                0% {
                    opacity: 0;
                    transform: translateY(-20px) scale(0.95);
                    backdrop-filter: blur(0px);
                }
                100% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                    backdrop-filter: blur(40px) saturate(180%);
                }
            }

            @keyframes slideInStagger {
                0% {
                    opacity: 0;
                    transform: translateY(20px) scale(0.9);
                }
                100% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            @keyframes slideOutStagger {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-15px) scale(0.9);
                }
            }
            
            .nav-links.nav-menu.mobile-open a {
                color: white !important;
                font-size: 1.15rem !important;
                font-weight: 600 !important;
                padding: 16px 24px !important;
                border-radius: 16px !important;
                background: rgba(255, 255, 255, 0.08) !important;
                backdrop-filter: blur(20px) !important;
                -webkit-backdrop-filter: blur(20px) !important;
                transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
                text-decoration: none !important;
                text-align: center !important;
                display: block !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                box-shadow: 
                    0 4px 20px rgba(0, 0, 0, 0.1),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
                position: relative !important;
                overflow: hidden !important;
            }

            /* Effet de brillance sur hover */
            .nav-links.nav-menu.mobile-open a::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
                transition: left 0.6s ease;
            }

            .nav-links.nav-menu.mobile-open a:hover::before {
                left: 100%;
            }

            .nav-links.nav-menu.mobile-open a:hover {
                background: rgba(255, 255, 255, 0.15) !important;
                backdrop-filter: blur(25px) saturate(150%) !important;
                transform: translateY(-2px) scale(1.02) !important;
                box-shadow: 
                    0 8px 30px rgba(102, 126, 234, 0.2),
                    0 4px 15px rgba(255, 255, 255, 0.1),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
                border-color: rgba(255, 255, 255, 0.2) !important;
                color: #E3F2FD !important;
            }

            .nav-links.nav-menu.mobile-open a:active {
                transform: translateY(0) scale(0.98) !important;
                transition: all 0.1s ease !important;
            }
            
            /* SOS Link style en mobile - GLASSMORPHISM AMÉLIORÉ */
            .nav-links.nav-menu.mobile-open .sos-link {
                background: linear-gradient(135deg, 
                    rgba(255, 68, 68, 0.25) 0%, 
                    rgba(255, 100, 100, 0.15) 100%) !important;
                border: 1px solid rgba(255, 68, 68, 0.4) !important;
                color: #FFE4E4 !important;
                box-shadow: 
                    0 6px 25px rgba(255, 68, 68, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15),
                    0 0 20px rgba(255, 68, 68, 0.1) !important;
                position: relative !important;
            }

            .nav-links.nav-menu.mobile-open .sos-link::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, transparent 30%, rgba(255, 68, 68, 0.1) 50%, transparent 70%);
                opacity: 0;
                transition: opacity 0.6s ease;
                border-radius: 15px;
            }

            .nav-links.nav-menu.mobile-open .sos-link:hover::after {
                opacity: 1;
                animation: sosGlow 1.5s ease-in-out infinite alternate;
            }

            @keyframes sosGlow {
                0% { box-shadow: 0 0 20px rgba(255, 68, 68, 0.3); }
                100% { box-shadow: 0 0 35px rgba(255, 68, 68, 0.6); }
            }
            
            .nav-links.nav-menu.mobile-open .sos-link:hover {
                background: linear-gradient(135deg, 
                    rgba(255, 68, 68, 0.4) 0%, 
                    rgba(255, 100, 100, 0.25) 100%) !important;
                border-color: rgba(255, 68, 68, 0.6) !important;
                transform: translateY(-3px) scale(1.03) !important;
                box-shadow: 
                    0 12px 40px rgba(255, 68, 68, 0.25),
                    0 6px 20px rgba(255, 68, 68, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2),
                    0 0 30px rgba(255, 68, 68, 0.2) !important;
                color: white !important;
            }

            .nav-links.nav-menu.mobile-open .sos-link i {
                filter: drop-shadow(0 0 8px rgba(255, 68, 68, 0.5));
                animation: toolsPulse 2s ease-in-out infinite;
            }

            @keyframes toolsPulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }
        }
    </style>
</head>
<body>
    <!-- Background Video Cloudinary optimisé avec formats multiples et fallback -->
    <div class="video-background">
        <video id="backgroundVideo" autoplay muted loop playsinline preload="metadata" webkit-playsinline poster="https://res.cloudinary.com/ddulasmtz/image/upload/v1752950782/villa-background-fallback.jpg">
            <source src="https://res.cloudinary.com/ddulasmtz/video/upload/v1752950782/background-video.webm" type="video/webm">
            <source src="https://res.cloudinary.com/ddulasmtz/video/upload/v1752950782/background-video.mp4_qoofsz.mp4" type="video/mp4">
            <!-- Fallback pour navigateurs sans support vidéo -->
            <div class="video-fallback" style="
                background-image: url('https://res.cloudinary.com/ddulasmtz/image/upload/v1752950782/villa-background-fallback.jpg');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
                width: 100%;
                height: 100vh;
                position: absolute;
                top: 0;
                left: 0;
            "></div>
            Votre navigateur ne supporte pas la lecture de vidéos HTML5.
        </video>
        <div class="video-overlay"></div>
    </div>

    <!-- Header -->

    <!-- Main Content -->
    <main class="main-content">
        <!-- Section Accueil -->
        <section id="home" class="section active">
            <div class="container">
                <div class="hero-logo">
                    <img src="https://customer-assets.emergentagent.com/job_luxestay/artifacts/36sqn0fh_IMG_9175.png" alt="KhanelConcept - Villas de Luxe Martinique" class="hero-logo-image">
                </div>
                <p>Villas de luxe et services exceptionnels dans un cadre paradisiaque</p>
                
                <section class="categories-section">
                    <h2 class="section-title">Catégories</h2>
                    <div class="villas-grid">
                        <a href="villas.html" class="villa-card category-card">
                            <div class="villa-image-container">
                                <img src="images/categories/nos-villas.jpg" alt="Nos Villas" class="villa-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="image-placeholder" style="display:none;">🏡</div>
                            </div>
                            <div class="villa-content"><h3>Nos Villas</h3></div>
                        </a>
                        <a href="prestataires.html" class="villa-card category-card">
                            <div class="villa-image-container">
                                <img src="images/categories/prestataires.jpg" alt="Prestataires" class="villa-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="image-placeholder" style="display:none;">🧰</div>
                            </div>
                            <div class="villa-content"><h3>Prestataires</h3></div>
                        </a>
                        <a href="activites-loisirs.html" class="villa-card category-card">
                            <div class="villa-image-container">
                                <img src="images/categories/activites-loisirs.jpg" alt="Activités/Loisirs" class="villa-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="image-placeholder" style="display:none;">🎟️</div>
                            </div>
                            <div class="villa-content"><h3>Activités/Loisirs</h3></div>
                        </a>
                        <a href="prestataires-evenementiels.html" class="villa-card category-card">
                            <div class="villa-image-container">
                                <img src="images/categories/prestataires-evenementiels.jpg" alt="Prestataires événementiels" class="villa-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="image-placeholder" style="display:none;">🪑</div>
                            </div>
                            <div class="villa-content"><h3>Prestataires événementiels</h3></div>
                        </a>
                        <a href="pmr.html" class="villa-card category-card">
                            <div class="villa-image-container">
                                <img src="images/categories/pmr.jpg" alt="PMR" class="villa-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="image-placeholder" style="display:none;">♿</div>
                            </div>
                            <div class="villa-content"><h3>PMR</h3></div>
                        </a>
                        <a href="location-de-voiture.html" class="villa-card category-card">
                            <div class="villa-image-container">
                                <img src="images/categories/location-de-voiture.jpg" alt="Location de voiture" class="villa-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="image-placeholder" style="display:none;">🚗</div>
                            </div>
                            <div class="villa-content"><h3>Location de voiture</h3></div>
                        </a>
                        <a href="evenement.html" class="villa-card category-card">
                            <div class="villa-image-container">
                                <img src="images/categories/evenement.jpg" alt="Événement" class="villa-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="image-placeholder" style="display:none;">🎉</div>
                            </div>
                            <div class="villa-content"><h3>Événement</h3></div>
                        </a>
                        <a href="se-deplacer.html" class="villa-card category-card">
                            <div class="villa-image-container">
                                <img src="images/categories/se-deplacer.jpg" alt="Se déplacer" class="villa-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="image-placeholder" style="display:none;">🚌</div>
                            </div>
                            <div class="villa-content"><h3>Se déplacer</h3></div>
                        </a>
                    </div>
                </section>
            </div>
                
            <div class="container">
                
                <!-- Filtres -->
                <div class="filters">
                    <button class="filter-btn active" onclick="filterVillas('all')">Toutes</button>
                    <button class="filter-btn" onclick="filterVillas('sejour')">Séjour</button>
                    <button class="filter-btn" onclick="filterVillas('fete')">Fête/Journée</button>
                </div>
                
                <h2>🏖️ Nos Villas de Luxe</h2>
                <div class="status-message" id="status-message" style="display: none;"></div>
                <div class="villas-grid" id="villasGrid">
                    <!-- Les villas seront chargées dynamiquement -->
                </div>
            </div>
        </section>

        <!-- Section Prestataires -->
        <section id="prestataires" class="section">
            <div class="container">
                <h1>🌊 Nos Prestataires de Services</h1>
                <p>Explorez nos services nautiques, culinaires et événementiels</p>
                
                <div class="villas-grid">
                    <div class="glass-card">
                        <h3>🚤 Excursions Nautiques</h3>
                        <p>Découvrez la beauté de la Martinique depuis la mer avec nos excursions en catamaran.</p>
                        <div class="price">À partir de 120€/personne</div>
                        <button class="btn-primary" onclick="contactPrestataire('nautique')">Réserver</button>
                    </div>
                    
                    <div class="glass-card">
                        <h3>🍽️ Services Culinaires</h3>
                        <p>Savourez la cuisine créole authentique avec nos chefs professionnels.</p>
                        <div class="price">À partir de 80€/personne</div>
                        <button class="btn-primary" onclick="contactPrestataire('culinaire')">Réserver</button>
                    </div>
                    
                    <div class="glass-card">
                        <h3>🎉 Organisation d'Événements</h3>
                        <p>Confiez-nous l'organisation de vos événements mémorables.</p>
                        <div class="price">Devis personnalisé</div>
                        <button class="btn-primary" onclick="contactPrestataire('evenements')">Demander un devis</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Autres sections -->
        <section id="billetterie" class="section">
            <div class="container">
                <h1>🎫 Billetterie Événementielle</h1>
                <p>Organisez et participez aux meilleurs événements de Martinique</p>
                <div class="glass-card">
                    <h3>🎭 Événements à Venir</h3>
                    <p>Découvrez notre programmation d'événements culturels et festifs.</p>
                    <button class="btn-primary" onclick="showComingSoon()">Voir les événements</button>
                </div>
            </div>
        </section>

        <section id="mobilier" class="section">
            <div class="container">
                <h1>🛋️ Location de Mobilier</h1>
                <p>Tables, chaises, décoration pour vos événements</p>
                <div class="glass-card">
                    <h3>🪑 Mobilier d'Événement</h3>
                    <p>Location de mobilier haut de gamme pour tous vos événements.</p>
                    <button class="btn-primary" onclick="contactPrestataire('mobilier')">Demander un devis</button>
                </div>
            </div>
        </section>

        <section id="excursions" class="section">
            <div class="container">
                <h1>⛵ Excursions Inoubliables</h1>
                <p>Découvrez la Martinique par terre, mer et air</p>
                <div class="glass-card">
                    <h3>🏝️ Tours de l'Île</h3>
                    <p>Explorez les merveilles cachées de la Martinique avec nos guides experts.</p>
                    <button class="btn-primary" onclick="contactPrestataire('excursions')">Réserver</button>
                </div>
            </div>
        </section>

        <section id="pmr" class="section">
            <div class="container">
                <h1>👑 Accessibilité PMR</h1>
                <p>Des séjours adaptés pour tous</p>
                <div class="glass-card">
                    <h3>♿ Villas Accessibles</h3>
                    <p>Découvrez nos villas spécialement aménagées pour les personnes à mobilité réduite.</p>
                    <a class="btn-primary" href="pmr.html">Voir les villas PMR</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal de réservation -->
    <div id="reservationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReservationModal()">&times;</span>
            <h2 id="modalVillaName">Réservation Villa</h2>
            
            <form id="reservationForm">
                <div class="form-group">
                    <label for="customerName">Nom complet *</label>
                    <input type="text" id="customerName" required>
                </div>
                
                <div class="form-group">
                    <label for="customerEmail">Email *</label>
                    <input type="email" id="customerEmail" required>
                </div>
                
                <div class="form-group">
                    <label for="customerPhone">Téléphone *</label>
                    <input type="tel" id="customerPhone" required>
                </div>
                
                <div style="display: flex; gap: 1rem;">
                    <div class="form-group" style="flex: 1;">
                        <label for="modalCheckin">Date d'arrivée *</label>
                        <input type="text" id="modalCheckin" required>
                    </div>
                    
                    <div class="form-group" style="flex: 1;">
                        <label for="modalCheckout">Date de départ *</label>
                        <input type="text" id="modalCheckout" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="modalGuests">Nombre de voyageurs *</label>
                    <select id="modalGuests" required>
                        <option value="">Choisir le nombre</option>
                        <option value="2">2 personnes</option>
                        <option value="4">4 personnes</option>
                        <option value="6">6 personnes</option>
                        <option value="8">8 personnes</option>
                        <option value="10">10 personnes</option>
                        <option value="15">15+ personnes</option>
                    </select>
                </div>
                
                <div id="priceCalculation" class="price-summary" style="display: none;">
                    <h3>📋 Résumé de la réservation</h3>
                    <div class="price-line">
                        <span>Villa :</span>
                        <span id="summaryVillaName">-</span>
                    </div>
                    <div class="price-line">
                        <span>Dates :</span>
                        <span id="summaryDates">-</span>
                    </div>
                    <div class="price-line">
                        <span>Nombre de nuits :</span>
                        <span id="summaryNights">-</span>
                    </div>
                    <div class="price-line">
                        <span>Prix par nuit :</span>
                        <span id="summaryPricePerNight">-</span>
                    </div>
                    <div class="price-line price-total">
                        <span>Total :</span>
                        <span id="summaryTotal">-</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="customerMessage">Message ou demandes spéciales</label>
                    <textarea id="customerMessage" rows="3" placeholder="Décrivez vos besoins particuliers..."></textarea>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="button" onclick="closeReservationModal()" class="btn-secondary" style="flex: 1;">Annuler</button>
                    <button type="submit" class="btn-primary" style="flex: 2;">
                        <i class="fas fa-calendar-check"></i>
                        Confirmer la réservation
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de galerie d'images -->
    <div id="imageGalleryModal" class="image-gallery-modal">
        <div class="gallery-content">
            <span class="gallery-close" onclick="closeImageGallery()">&times;</span>
            <button class="gallery-nav gallery-prev" onclick="previousImage()">❮</button>
            <img id="galleryImage" class="gallery-image" src="" alt="">
            <button class="gallery-nav gallery-next" onclick="nextImage()">❯</button>
            
            <div class="gallery-thumbnails" id="galleryThumbnails">
                <!-- Les miniatures seront générées dynamiquement -->
            </div>
        </div>
    </div>

    <!-- Admin Access Link -->
    <a href="admin/login.html" class="admin-link" style="position:fixed; bottom:20px; right:20px; color:#666; font-size:18px; text-decoration:none; opacity:0.7; background:rgba(255,255,255,0.95); padding:12px; border-radius:50%; backdrop-filter:blur(10px); transition:all 0.3s ease; z-index:9999; box-shadow:0 4px 15px rgba(0,0,0,0.2); border:2px solid rgba(255,165,0,0.3); display:flex; align-items:center; justify-content:center; width:50px; height:50px;" onclick="return confirm('Accès administrateur uniquement')" title="Administration" onmouseover="this.style.opacity='1'; this.style.transform='scale(1.1)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.opacity='0.7'; this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">⚙️</a>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/fr.js"></script>

    <script>
        // ===== INTERSECTION OBSERVER POUR ANIMATIONS AU SCROLL =====
        
        // Observer pour les villas (déclaration globale)
        let observer;
        let generalObserver;
        
        // Initialiser les observers
        function initializeObservers() {
            // Observer pour les villas
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        // On garde l'observation pour l'effet hover
                    }
                });
            }, observerOptions);
            
            // Observer pour les autres éléments
            generalObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });
        }
        
        // Initialiser les observers au chargement
        document.addEventListener('DOMContentLoaded', () => {
            // Initialiser les observers
            initializeObservers();
            
            // Observer les autres éléments (pas les villas qui sont créées dynamiquement)
            const animatedElements = document.querySelectorAll('.animate-on-scroll');
            animatedElements.forEach(el => {
                generalObserver.observe(el);
            });
            
            // Observer les titres et sections
            const titles = document.querySelectorAll('h1, h2, h3, .section-title');
            titles.forEach(title => {
                title.classList.add('animate-on-scroll');
                generalObserver.observe(title);
            });
        });
        
        // ===== FONCTIONS EXISTANTES =====
        
        // ===== DONNÉES STATIQUES DES VILLAS POUR GITHUB PAGES =====
        const villasData = [
            // VILLAS DE SÉJOUR - DONNÉES RÉELLES CORRIGÉES
            {
                id: 1,
                name: "Villa F3 sur Petit Macabou",
                location: "Petit Macabou au Vauclin",
                price: 850,
                priceUnit: "€/nuit",
                guests: 6,
                guestsDetail: "6 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F3_Petit_Macabou/01_piscine_exterieur.jpg",
                gallery: [
                    "./images/Villa_F3_Petit_Macabou/01_piscine_exterieur.jpg",
                    "./images/Villa_F3_Petit_Macabou/02_terrasse_salon_exterieur.jpg",
                    "./images/Villa_F3_Petit_Macabou/03_salle_de_bain_moderne.jpg"
                ],
                fallbackIcon: "🏊",
                description: "Belle villa Villa F3 sur Petit Macabou située à Petit Macabou au Vauclin. Capacité 6 personnes.",
                pricing_details: { base_price: 850.0, price_type: "per_night" }
            },
            {
                id: 2,
                name: "Villa F5 sur Ste Anne",
                location: "Quartier Les Anglais, Ste Anne",
                price: 1350,
                priceUnit: "€/nuit",
                guests: 10,
                guestsDetail: "10 personnes",
                features: "Piscine, décoration distinctive",
                category: "sejour",
                image: "./images/Villa_F5_Ste_Anne/01_piscine_principale.jpg",
                gallery: [
                    "./images/Villa_F5_Ste_Anne/01_piscine_principale.jpg",
                    "./images/Villa_F5_Ste_Anne/02_piscine_vue_aerienne.jpg"
                ],
                fallbackIcon: "🌸",
                description: "Belle villa Villa F5 sur Ste Anne située à Quartier Les Anglais, Ste Anne. Capacité 10 personnes.",
                pricing_details: { base_price: 1350.0, price_type: "per_night" }
            },
            {
                id: 3,
                name: "Villa F3 Baccha Petit Macabou",
                location: "Petit Macabou",
                price: 1350,
                priceUnit: "€/nuit",
                guests: 6,
                guestsDetail: "6 personnes",
                features: "Piscine, terrasses modernes",
                category: "sejour",
                image: "./images/Villa_F3_Baccha_Petit_Macabou/01_terrasse_piscine_salon_ext.jpg",
                gallery: [
                    "./images/Villa_F3_Baccha_Petit_Macabou/01_terrasse_piscine_salon_ext.jpg",
                    "./images/Villa_F3_Baccha_Petit_Macabou/02_terrasse_piscine_angle.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F3 Baccha Petit Macabou située à Petit Macabou. Capacité 6 personnes.",
                pricing_details: { base_price: 1350.0, price_type: "per_night" }
            },
            {
                id: 4,
                name: "Villa F6 Lamentin",
                location: "Quartier Bélème au Lamentin",
                price: 1500,
                priceUnit: "€/nuit",
                guests: 10,
                guestsDetail: "10 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F6_Lamentin/01_piscine_jacuzzi_vue_ensemble.jpg",
                gallery: [
                    "./images/Villa_F6_Lamentin/01_piscine_jacuzzi_vue_ensemble.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F6 Lamentin située à Quartier Bélème au Lamentin. Capacité 10 personnes.",
                pricing_details: { base_price: 1500.0, price_type: "per_night" }
            },
            {
                id: 5,
                name: "Villa F6 Ste Luce Plage",
                location: "Zac de Pont Café, Ste Luce",
                price: 1700,
                priceUnit: "€/nuit",
                guests: 14,
                guestsDetail: "14 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F6_Ste_Luce_Plage/05_vue_aerienne_piscine.jpg",
                gallery: [
                    "./images/Villa_F6_Ste_Luce_Plage/05_vue_aerienne_piscine.jpg",
                    "./images/Villa_F6_Ste_Luce_Plage/06_salon_piscine.jpg",
                    "./images/Villa_F6_Ste_Luce_Plage/03_cuisine_moderne.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F6 Ste Luce Plage située à Zac de Pont Café, Ste Luce. Capacité 14 personnes.",
                pricing_details: { base_price: 1700.0, price_type: "per_night" }
            },
            {
                id: 6,
                name: "Villa F6 sur Petit Macabou",
                location: "Petit Macabou au Vauclin",
                price: 2000,
                priceUnit: "€/nuit",
                guests: 13,
                guestsDetail: "13 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F6_Petit_Macabou/02_salle_de_bain.jpg",
                gallery: [
                    "./images/Villa_F6_Petit_Macabou/02_salle_de_bain.jpg",
                    "./images/Villa_F6_Petit_Macabou/03_chambre_studio.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F6 sur Petit Macabou située à Petit Macabou au Vauclin. Capacité 13 personnes.",
                pricing_details: { base_price: 2000.0, price_type: "per_night" }
            },
            {
                id: 7,
                name: "Villa F7 Baie des Mulets",
                location: "Baie des Mulets, Trinité",
                price: 2200,
                priceUnit: "€/nuit",
                guests: 15,
                guestsDetail: "15 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F7_Baie_des_Mulets_Vauclin/salon_canape_angle_gris.jpg",
                gallery: [
                    "./images/Villa_F7_Baie_des_Mulets_Vauclin/salon_canape_angle_gris.jpg",
                    "./images/Villa_F7_Baie_des_Mulets_Vauclin/cuisine_moderne_blanche.jpg",
                    "./images/Villa_F7_Baie_des_Mulets_Vauclin/chambre_principale_bleu_jaune.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F7 Baie des Mulets située à Baie des Mulets, Trinité. Capacité 15 personnes.",
                pricing_details: { base_price: 2200.0, price_type: "per_night" }
            },
            {
                id: 8,
                name: "Villa F3 Trinité (Cosmy)",
                location: "Cosmy, Trinité",
                price: 900,
                priceUnit: "€/nuit",
                guests: 6,
                guestsDetail: "6 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F3_Trinite_Cosmy/piscine_chauffee_vue_collines.jpg",
                gallery: [
                    "./images/Villa_F3_Trinite_Cosmy/piscine_chauffee_vue_collines.jpg",
                    "./images/Villa_F3_Trinite_Cosmy/salon_canape_angle_marron_coussins_turquoise.jpg",
                    "./images/Villa_F3_Trinite_Cosmy/cuisine_americaine_jaune_bois.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F3 Trinité (Cosmy) située à Cosmy, Trinité. Capacité 6 personnes.",
                pricing_details: { base_price: 900.0, price_type: "per_night" }
            },
            {
                id: 9,
                name: "Villa F3 Le Robert",
                location: "Le Robert",
                price: 1000,
                priceUnit: "€/nuit",
                guests: 6,
                guestsDetail: "6 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F3_Robert_Pointe_Hyacinthe/piscine_rectangulaire_moderne.jpg",
                gallery: [
                    "./images/Villa_F3_Robert_Pointe_Hyacinthe/piscine_rectangulaire_moderne.jpg",
                    "./images/Villa_F3_Robert_Pointe_Hyacinthe/salon_salle_a_manger_tv.jpg",
                    "./images/Villa_F3_Robert_Pointe_Hyacinthe/cuisine_ouverte_plan_travail.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F3 Le Robert située à Le Robert. Capacité 6 personnes.",
                pricing_details: { base_price: 1000.0, price_type: "per_night" }
            },
            {
                id: 10,
                name: "Villa F5 R.Pilote",
                location: "Rivière-Pilote",
                price: 1200,
                priceUnit: "€/nuit",
                guests: 8,
                guestsDetail: "8 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F5_R_Pilote_La_Renee/piscine_terrasse_bois_palmiers.jpg",
                gallery: [
                    "./images/Villa_F5_R_Pilote_La_Renee/piscine_terrasse_bois_palmiers.jpg",
                    "./images/Villa_F5_R_Pilote_La_Renee/salon_cuir_noir_plafond_vert.jpg",
                    "./images/Villa_F5_R_Pilote_La_Renee/cuisine_equipee_bois_clair.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F5 R.Pilote située à Rivière-Pilote. Capacité 8 personnes.",
                pricing_details: { base_price: 1200.0, price_type: "per_night" }
            },
            {
                id: 11,
                name: "Villa F3 Le François",
                location: "Le François",
                price: 1100,
                priceUnit: "€/nuit",
                guests: 6,
                guestsDetail: "6 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F3_Le_Francois/01_terrasse_piscine_vue_mer.jpg",
                gallery: [
                    "./images/Villa_F3_Le_Francois/01_terrasse_piscine_vue_mer.jpg",
                    "./images/Villa_F3_Le_Francois/02_terrasse_repas_vue_panoramique.jpg",
                    "./images/Villa_F3_Le_Francois/03_salon_exterieur_detente.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F3 Le François située à Le François. Capacité 6 personnes.",
                pricing_details: { base_price: 1100.0, price_type: "per_night" }
            },
            {
                id: 12,
                name: "Villa F5 Vauclin Ravine Plate",
                location: "Ravine Plate, Le Vauclin",
                price: 1400,
                priceUnit: "€/nuit",
                guests: 10,
                guestsDetail: "10 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F5_Vauclin_Ravine_Plate/piscine_a_debordement_vue_panoramique.jpg",
                gallery: [
                    "./images/Villa_F5_Vauclin_Ravine_Plate/piscine_a_debordement_vue_panoramique.jpg",
                    "./images/Villa_F5_Vauclin_Ravine_Plate/salon_moderne_rouge_noir_escalier.jpg",
                    "./images/Villa_F5_Vauclin_Ravine_Plate/terrasse_panoramique_gazebo_vue_collines.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F5 Vauclin Ravine Plate située à Ravine Plate, Le Vauclin. Capacité 10 personnes.",
                pricing_details: { base_price: 1400.0, price_type: "per_night" }
            },
            {
                id: 13,
                name: "Bas Villa F3 Ste Luce",
                location: "Ste Luce",
                price: 1300,
                priceUnit: "€/nuit",
                guests: 8,
                guestsDetail: "8 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Bas_Villa_F3_Ste_Luce/01_chambre_salle_a_manger.jpg",
                gallery: [
                    "./images/Bas_Villa_F3_Ste_Luce/01_chambre_salle_a_manger.jpg",
                    "./images/Bas_Villa_F3_Ste_Luce/salon_canape_lit.jpg",
                    "./images/Bas_Villa_F3_Ste_Luce/terrasse_salon_exterieur_1.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Bas Villa F3 Ste Luce située à Ste Luce. Capacité 8 personnes.",
                pricing_details: { base_price: 1300.0, price_type: "per_night" }
            },
            {
                id: 14,
                name: "Villa F3 Trenelle",
                location: "Trenelle",
                price: 1600,
                priceUnit: "€/nuit",
                guests: 6,
                guestsDetail: "6 personnes",
                features: "Piscine, équipements modernes",
                category: "sejour",
                image: "./images/Villa_F3_Trenelle_Location_Annuelle/01_salon_salle_a_manger.jpg",
                gallery: [
                    "./images/Villa_F3_Trenelle_Location_Annuelle/01_salon_salle_a_manger.jpg",
                    "./images/Villa_F3_Trenelle_Location_Annuelle/02_espace_detente.jpg",
                    "./images/Villa_F3_Trenelle_Location_Annuelle/05_cuisine_equipee.jpg"
                ],
                fallbackIcon: "🏖️",
                description: "Belle villa Villa F3 Trenelle située à Trenelle. Capacité 6 personnes.",
                pricing_details: { base_price: 1600.0, price_type: "per_night" }
            },
            {
                id: 15,
                name: "Studio Cocooning Lamentin",
                location: "Lamentin",
                price: 600,
                priceUnit: "€/nuit",
                guests: 2,
                guestsDetail: "2 personnes",
                features: "Jacuzzi privé, vue panoramique",
                category: "sejour",
                image: "./images/Studio_Cocooning_Lamentin/01_studio_vue_ensemble.jpg",
                gallery: [
                    "./images/Studio_Cocooning_Lamentin/01_studio_vue_ensemble.jpg",
                    "./images/Studio_Cocooning_Lamentin/02_cuisine_moderne.jpg"
                ],
                fallbackIcon: "💕",
                description: "Studio romantique parfait pour couples.",
                pricing_details: { base_price: 600.0, price_type: "per_night" }
            },

            // VILLAS POUR FÊTES - DONNÉES RÉELLES CORRIGÉES
            {
                id: 16,
                name: "Espace Piscine Journée Bungalow",
                location: "Bungalow",
                price: 350,
                priceUnit: "€/jour",
                guests: 10,
                guestsDetail: "10 à 150 personnes",
                features: "Cuisine, salle d'eau, mobilier (chaises, tables), chambre climatisée",
                category: "fete",
                image: "./images/Espace_Piscine_Journee_Bungalow/bungalow_exterieur_veranda_creole.jpg",
                gallery: [
                    "./images/Espace_Piscine_Journee_Bungalow/bungalow_exterieur_veranda_creole.jpg",
                    "./images/Espace_Piscine_Journee_Bungalow/bungalow_interieur_studio_kitchenette.jpg"
                ],
                fallbackIcon: "🏊",
                description: "Espace piscine pour la journée avec bungalow. Idéal pour se détendre et profiter de la piscine. Capacité jusqu'à 150 personnes pour des événements.",
                pricing_details: { base_price: 350.0, price_type: "per_day" }
            },
            {
                id: 17,
                name: "Villa Fête Journée Ducos",
                location: "Ducos",
                price: 200,
                priceUnit: "€/jour",
                guests: 25,
                guestsDetail: "25 personnes",
                features: "Piscine, espace fête",
                category: "fete",
                image: "./images/Villa_Fete_Journee_Ducos/01_piscine_jouets_gonflables.jpg",
                gallery: [
                    "./images/Villa_Fete_Journee_Ducos/01_piscine_jouets_gonflables.jpg",
                    "./images/Villa_Fete_Journee_Ducos/02_terrasse_couverte_salon.jpg",
                    "./images/Villa_Fete_Journee_Ducos/03_bar_exterieur_gazebo.jpg"
                ],
                fallbackIcon: "🎉",
                description: "Villa parfaite pour organiser des fêtes et événements.",
                pricing_details: { base_price: 200.0, price_type: "per_day" }
            },
            {
                id: 18,
                name: "Villa Fête Journée Fort de France",
                location: "Fort-de-France",
                price: 180,
                priceUnit: "€/jour",
                guests: 20,
                guestsDetail: "20 personnes",
                features: "Piscine, terrasse couverte",
                category: "fete",
                image: "./images/Villa_Fete_Journee_Fort_de_France/01_piscine_vue_panoramique.jpg",
                gallery: [
                    "./images/Villa_Fete_Journee_Fort_de_France/01_piscine_vue_panoramique.jpg",
                    "./images/Villa_Fete_Journee_Fort_de_France/02_piscine_statues_buddha.jpg",
                    "./images/Villa_Fete_Journee_Fort_de_France/03_terrasse_colonnes_vue.jpg"
                ],
                fallbackIcon: "🏛️",
                description: "Villa pour fêtes à Fort-de-France.",
                pricing_details: { base_price: 180.0, price_type: "per_day" }
            },
            {
                id: 19,
                name: "Villa Fête Journée Rivière Pilote",
                location: "Rivière-Pilote",
                price: 250,
                priceUnit: "€/jour",
                guests: 35,
                guestsDetail: "35 personnes",
                features: "Grande piscine, espace barbecue",
                category: "fete",
                image: "./images/Villa_Fete_Journee_R_Pilote/04_piscine_tropicale_vue_panoramique.jpg",
                gallery: [
                    "./images/Villa_Fete_Journee_R_Pilote/04_piscine_tropicale_vue_panoramique.jpg",
                    "./images/Villa_Fete_Journee_R_Pilote/03_villa_creole_piscine_terrasse.jpg",
                    "./images/Villa_Fete_Journee_R_Pilote/05_cuisine_moderne_equipee.jpg"
                ],
                fallbackIcon: "🔥",
                description: "Villa spacieuse pour grandes fêtes.",
                pricing_details: { base_price: 250.0, price_type: "per_day" }
            },
            {
                id: 20,
                name: "Villa Fête Journée Sainte-Luce",
                location: "Sainte-Luce",
                price: 160,
                priceUnit: "€/jour",
                guests: 15,
                guestsDetail: "15 personnes",
                features: "Piscine, jardins tropicaux",
                category: "fete",
                image: "./images/Villa_Fete_Journee_Sainte_Luce/01_villa_moderne_piscine_terrasse.jpg",
                gallery: [
                    "./images/Villa_Fete_Journee_Sainte_Luce/01_villa_moderne_piscine_terrasse.jpg",
                    "./images/Villa_Fete_Journee_Sainte_Luce/02_piscine_tentes_amenagement.jpg",
                    "./images/Villa_Fete_Journee_Sainte_Luce/03_tentes_blanches_mobilier.jpg"
                ],
                fallbackIcon: "🌺",
                description: "Villa pour fêtes avec jardins tropicaux.",
                pricing_details: { base_price: 160.0, price_type: "per_day" }
            },
            {
                id: 21,
                name: "Espace Piscine Journée Bungalow",
                location: "Location spéciale",
                price: 350,
                priceUnit: "€/jour",
                guests: 150,
                guestsDetail: "10 à 150 personnes",
                features: "Piscine, espace couvert, bungalow",
                category: "fete",
                image: "./images/Espace_Piscine_Journee_Bungalow/bungalow_exterieur_veranda_creole.jpg",
                gallery: [
                    "./images/Espace_Piscine_Journee_Bungalow/bungalow_exterieur_veranda_creole.jpg",
                    "./images/Espace_Piscine_Journee_Bungalow/bungalow_interieur_studio_kitchenette.jpg"
                ],
                fallbackIcon: "🏊",
                description: "Espace piscine avec bungalow pour journée détente ou fêtes. Capacité de 10 à 150 personnes.",
                pricing_details: { base_price: 350.0, price_type: "per_day" }
            }
        ];

        let filteredVillas = [...villasData];
        let currentVilla = null;
        let currentGalleryIndex = 0;
        let currentGallery = [];

        // Pour GitHub Pages - Pas besoin d'API
        async function loadVillasFromAPI() {
            console.log("🏖️ GitHub Pages détecté - utilisation des données statiques");
            console.log(`✅ ${villasData.length} villas chargées (données intégrées)`);
            
            // Vérifier si Espace Piscine est présent
            const espacePiscine = villasData.find(v => v.name.includes('Espace Piscine'));
            if (espacePiscine) {
                console.log(`✅ "Espace Piscine" trouvé: ${espacePiscine.name} - ${espacePiscine.price}€`);
            }
            
            // Afficher les villas
            filteredVillas = [...villasData];
            displayVillas();
            
            return true;
        }

        // Initialisation des calendriers
        let checkinCalendar, checkoutCalendar, modalCheckinCalendar, modalCheckoutCalendar;

        document.addEventListener('DOMContentLoaded', async function() {
            console.log("🚀 DOM Content Loaded - Initialisation...");
            
            // CHARGEMENT DYNAMIQUE DES VILLAS DEPUIS L'API
            const apiLoaded = await loadVillasFromAPI();
            
            if (!apiLoaded) {
                console.warn("⚠️ Impossible de charger les villas depuis l'API");
                // Afficher un message d'erreur à l'utilisateur
                const grid = document.getElementById('villasGrid');
                if (grid) {
                    grid.innerHTML = `
                        <div class="glass-card" style="text-align: center; padding: 2rem;">
                            <h3 style="color: #ff6b6b; margin-bottom: 1rem;">
                                <i class="fas fa-exclamation-triangle"></i> Erreur de connexion
                            </h3>
                            <p style="color: white; margin-bottom: 1rem;">
                                Impossible de charger les villas depuis le serveur.
                            </p>
                            <button onclick="location.reload()" class="btn-primary" style="margin-top: 1rem;">
                                <i class="fas fa-refresh"></i> Réessayer
                            </button>
                        </div>
                    `;
                }
            }
            
            // CORRECTION 2 : Initialisation des calendriers avec vérification complète
            setTimeout(function() {
                console.log("📅 Initialisation des calendriers...");
                
                // Vérifier que Flatpickr est disponible
                if (typeof flatpickr === 'undefined') {
                    console.error("❌ Flatpickr n'est pas chargé !");
                    return;
                }
                
                // Vérifier que les éléments existent
                const checkinElement = document.getElementById('checkin');
                const checkoutElement = document.getElementById('checkout');
                
                if (!checkinElement || !checkoutElement) {
                    console.error("❌ Éléments calendrier non trouvés !");
                    return;
                }
                
                console.log("✅ Flatpickr disponible, éléments trouvés");
                
                // Initialiser les calendriers
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                try {
                    // Calendrier arrivée
                    checkinCalendar = flatpickr(checkinElement, {
                        locale: "fr",
                        minDate: today,
                        dateFormat: "d/m/Y",
                        allowInput: true,
                        clickOpens: true,
                        disableMobile: false,
                        onChange: function(selectedDates) {
                            console.log("📅 Date arrivée sélectionnée:", selectedDates[0]);
                            if (selectedDates[0] && checkoutCalendar) {
                                const nextDay = new Date(selectedDates[0]);
                                nextDay.setDate(nextDay.getDate() + 1);
                                checkoutCalendar.set('minDate', nextDay);
                            }
                        }
                    });
                    
                    // Calendrier départ
                    checkoutCalendar = flatpickr(checkoutElement, {
                        locale: "fr",
                        minDate: tomorrow,
                        dateFormat: "d/m/Y",
                        allowInput: true,
                        clickOpens: true,
                        disableMobile: false,
                        onChange: function(selectedDates) {
                            console.log("📅 Date départ sélectionnée:", selectedDates[0]);
                        }
                    });
                    
                    console.log("✅ Calendriers initialisés avec succès !");
                    
                    // CORRECTION MOBILE : Ajouter événements tactiles
                    setupMobileDateFieldsIndex();
                    
                    // Test d'ouverture forcée au clic
                    checkinElement.addEventListener('click', function(e) {
                        console.log("🖱️ Clic sur arrivée");
                        e.preventDefault();
                        if (checkinCalendar) {
                            checkinCalendar.open();
                        }
                    });
                    
                    checkoutElement.addEventListener('click', function(e) {
                        console.log("🖱️ Clic sur départ");
                        e.preventDefault();
                        if (checkoutCalendar) {
                            checkoutCalendar.open();
                        }
                    });
                    
                } catch (error) {
                    console.error("❌ Erreur initialisation calendriers:", error);
                }
                
            }, 500); // Délai plus long pour être sûr

            // Forcer l'ouverture des calendriers au clic
            document.getElementById('checkin').addEventListener('click', function() {
                if (checkinCalendar) {
                    checkinCalendar.open();
                }
            });

            document.getElementById('checkout').addEventListener('click', function() {
                if (checkoutCalendar) {
                    checkoutCalendar.open();
                }
            });

            // Calendriers de la modale
            modalCheckinCalendar = flatpickr("#modalCheckin", {
                locale: "fr",
                minDate: today,
                dateFormat: "d/m/Y",
                placeholder: "Date d'arrivée",
                onChange: function(selectedDates) {
                    if (selectedDates[0]) {
                        const nextDay = new Date(selectedDates[0]);
                        nextDay.setDate(nextDay.getDate() + 1);
                        modalCheckoutCalendar.set('minDate', nextDay);
                        calculatePrice();
                    }
                }
            });

            modalCheckoutCalendar = flatpickr("#modalCheckout", {
                locale: "fr",
                minDate: tomorrow,
                dateFormat: "d/m/Y",
                placeholder: "Date de départ",
                onChange: function() {
                    calculatePrice();
                }
            });

            // S'assurer que les villas s'affichent au chargement
            console.log(`📊 Nombre de villas chargées: ${villasData.length}`);
            console.log(`📊 Nombre de villas filtrées: ${filteredVillas.length}`);
            
            // Message de bienvenue
            showStatusMessage(`✅ Bienvenue sur KhanelConcept ! ${villasData.length} villas de luxe chargées automatiquement.`, 'success');
        });

        // Fonctions de gestion des sections
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            document.getElementById('nav-' + sectionId).classList.add('active');
        }

        // Fonctions de filtrage
        function filterVillas(category) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            if (category === 'all') {
                filteredVillas = [...villasData];
            } else if (category === 'pmr') {
                filteredVillas = villasData.filter(villa => 
                    villa.features.toLowerCase().includes('accessible') || 
                    villa.location.toLowerCase().includes('ste-luce') ||
                    villa.guests <= 4
                );
            } else {
                filteredVillas = villasData.filter(villa => villa.category === category);
            }
            
            displayVillas();
        }

        // ===== FONCTIONS BARRE DE RECHERCHE INTELLIGENTE =====
        
        // Liste des communes de Martinique pour l'autocomplete
        const communesMartinique = [
            'Sainte-Anne', 'Vauclin', 'Lamentin', 'Macabou', 'Petit Macabou', 'Sainte-Luce', 
            'Trinité', 'Le Robert', 'Rivière-Pilote', 'Ducos', 'Fort-de-France', 
            'Trenelle', 'Le Marin', 'Rivière-Salée', 'Les Trois-Îlets', 
            'Le Diamant', 'Les Anses-d\'Arlet', 'Le Carbet', 'Bellefontaine',
            'Case-Pilote', 'Schoelcher', 'Saint-Joseph', 'Le Lorrain',
            'Marigot', 'Sainte-Marie', 'Le Prêcheur', 'Grand\'Rivière',
            'L\'Ajoupa-Bouillon', 'Basse-Pointe', 'Macouba', 'Le Morne-Rouge',
            'Saint-Pierre', 'Le Morne-Vert', 'Fonds-Saint-Denis'
        ];

        // État des voyageurs
        let voyageursCount = {
            adultes: 2,
            enfants: 0,
            bebes: 0
        };

        let showLocationSuggestionsFlag = false;
        let showVoyageursDropdownFlag = false;

        // Fonction pour gérer l'input de localisation
        function handleLocationInput(value) {
            const suggestionsDiv = document.getElementById('suggestions-dropdown');
            
            if (value.length > 0) {
                const filtered = communesMartinique.filter(commune =>
                    commune.toLowerCase().includes(value.toLowerCase())
                );
                
                if (filtered.length > 0) {
                    suggestionsDiv.innerHTML = filtered.slice(0, 5).map(commune => 
                        `<div class="suggestion-item" onclick="selectLocation('${commune}')">📍 ${commune}</div>`
                    ).join('');
                    suggestionsDiv.style.display = 'block';
                } else {
                    suggestionsDiv.style.display = 'none';
                }
            } else {
                suggestionsDiv.style.display = 'none';
            }
        }

        // Fonction pour sélectionner une localisation
        function selectLocation(commune) {
            document.getElementById('location-search').value = commune;
            document.getElementById('suggestions-dropdown').style.display = 'none';
        }

        // Fonction pour montrer/cacher les suggestions
        function showLocationSuggestions(show) {
            showLocationSuggestionsFlag = show;
        }

        // Fonction pour toggle le dropdown voyageurs
        function toggleVoyageursDropdown() {
            const menu = document.getElementById('voyageurs-menu');
            
            if (!menu) return;
            
            showVoyageursDropdownFlag = !showVoyageursDropdownFlag;
            
            if (showVoyageursDropdownFlag) {
                // Afficher le dropdown avec animation
                menu.style.display = 'block';
                // Force reflow pour s'assurer que display:block est appliqué
                menu.offsetHeight;
                menu.classList.add('active');
                
                // Fermer le dropdown si on clique ailleurs
                document.addEventListener('click', closeDropdownOutside);
            } else {
                // Masquer le dropdown avec animation
                menu.classList.remove('active');
                setTimeout(() => {
                    if (!menu.classList.contains('active')) {
                        menu.style.display = 'none';
                    }
                }, 300);
                
                document.removeEventListener('click', closeDropdownOutside);
            }
        }
        
        // Fonction pour fermer le dropdown si on clique ailleurs
        function closeDropdownOutside(event) {
            const menu = document.getElementById('voyageurs-menu');
            const trigger = document.querySelector('.voyageurs-display');
            
            if (menu && trigger && !menu.contains(event.target) && !trigger.contains(event.target)) {
                showVoyageursDropdownFlag = false;
                menu.classList.remove('active');
                setTimeout(() => {
                    if (!menu.classList.contains('active')) {
                        menu.style.display = 'none';
                    }
                }, 300);
                document.removeEventListener('click', closeDropdownOutside);
            }
        }

        // Fonction pour mettre à jour le nombre de voyageurs
        function updateVoyageurs(type, increment) {
            if (type === 'adultes' && voyageursCount.adultes + increment < 1) return;
            if (voyageursCount[type] + increment < 0) return;
            
            voyageursCount[type] += increment;
            
            // Mettre à jour l'affichage
            document.getElementById(type + '-count').textContent = voyageursCount[type];
            updateVoyageursDisplay();
            
            // Désactiver/activer les boutons
            updateCounterButtons();
        }

        // Fonction pour afficher le texte des voyageurs
        function updateVoyageursDisplay() {
            let display = `${voyageursCount.adultes} adulte${voyageursCount.adultes > 1 ? 's' : ''}`;
            if (voyageursCount.enfants > 0) {
                display += `, ${voyageursCount.enfants} enfant${voyageursCount.enfants > 1 ? 's' : ''}`;
            }
            if (voyageursCount.bebes > 0) {
                display += `, ${voyageursCount.bebes} bébé${voyageursCount.bebes > 1 ? 's' : ''}`;
            }
            
            document.querySelector('.voyageurs-display').value = display;
        }

        // Fonction pour mettre à jour l'état des boutons
        function updateCounterButtons() {
            // Bouton minus adultes
            const adultesMinusBtn = document.querySelector('button[onclick="updateVoyageurs(\'adultes\', -1)"]');
            if (adultesMinusBtn) {
                adultesMinusBtn.disabled = voyageursCount.adultes <= 1;
            }
            
            // Boutons minus enfants et bébés
            const enfantsMinusBtn = document.querySelector('button[onclick="updateVoyageurs(\'enfants\', -1)"]');
            if (enfantsMinusBtn) {
                enfantsMinusBtn.disabled = voyageursCount.enfants <= 0;
            }
            
            const bebesMinusBtn = document.querySelector('button[onclick="updateVoyageurs(\'bebes\', -1)"]');
            if (bebesMinusBtn) {
                bebesMinusBtn.disabled = voyageursCount.bebes <= 0;
            }
        }

        // Gestion des clics en dehors des dropdowns
        document.addEventListener('click', function(event) {
            // Fermer suggestions localisation
            if (!event.target.closest('.location-field')) {
                document.getElementById('suggestions-dropdown').style.display = 'none';
            }
            
            // Fermer dropdown voyageurs
            if (!event.target.closest('.guests-field')) {
                document.getElementById('voyageurs-menu').classList.remove('active');
                showVoyageursDropdownFlag = false;
            }
        });

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateCounterButtons();
        });

        // ===== FIN FONCTIONS BARRE DE RECHERCHE INTELLIGENTE =====

        // 🔍 CORRECTION PHASE 1: Fonction de recherche corrigée et optimisée
        function performSearch() {
            console.log('🔍 Recherche déclenchée');
            
            // Récupérer les valeurs des champs
            const locationInput = document.getElementById('location-search');
            const guestsDisplay = document.querySelector('.voyageurs-display');
            
            if (!locationInput || !guestsDisplay) {
                console.error('❌ Champs de recherche non trouvés');
                showStatusMessage('Erreur dans les champs de recherche', 'error');
                return;
            }
            
            const destination = locationInput.value.toLowerCase().trim();
            const guestsDisplayValue = guestsDisplay.value || '';
            
            // Extraire le nombre d'adultes du texte (ex: "2 adultes" -> 2)
            const adultsMatch = guestsDisplayValue.match(/(\d+)\s+adulte/);
            const guests = adultsMatch ? parseInt(adultsMatch[1]) : 0;
            
            console.log('Critères de recherche:', { destination, guests, displayValue: guestsDisplayValue });

            showStatusMessage('Recherche en cours...', 'loading');

            // Effectuer la recherche avec timeout pour meilleure UX
            setTimeout(() => {
                // Vérifier que villasData existe
                if (typeof villasData === 'undefined' || !Array.isArray(villasData)) {
                    console.error('❌ villasData non disponible');
                    showStatusMessage('Erreur: données non disponibles', 'error');
                    return;
                }
                
                let results = [...villasData];
                console.log(`🏠 Recherche parmi ${results.length} villas`);

                // Filtrer par destination
                if (destination) {
                    results = results.filter(villa => {
                        const locationMatch = villa.location.toLowerCase().includes(destination);
                        const nameMatch = villa.name.toLowerCase().includes(destination);
                        return locationMatch || nameMatch;
                    });
                    console.log(`📍 Après filtre destination "${destination}": ${results.length} villas`);
                }

                // Filtrer par nombre d'invités
                if (guests > 0) {
                    results = results.filter(villa => villa.guests >= guests);
                    console.log(`👥 Après filtre invités (${guests}): ${results.length} villas`);
                }

                // Mettre à jour les résultats globaux
                if (typeof window !== 'undefined') {
                    window.filteredVillas = results;
                }
                filteredVillas = results;
                
                // Afficher les résultats
                displayVillas();
                
                // Afficher le message de statut
                if (results.length === 0) {
                    showStatusMessage('Aucune villa trouvée pour ces critères. Essayez avec d\'autres paramètres.', 'error');
                } else {
                    showStatusMessage(`${results.length} villa(s) trouvée(s) !`, 'success');
                    
                    // Scroll vers les résultats
                    const villaGrid = document.getElementById('villa-grid');
                    if (villaGrid) {
                        villaGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
                
                console.log('✅ Recherche terminée:', results.length, 'résultats');
            }, 300); // Délai pour meilleure UX
        }

        // Affichage des villas
        function displayVillas() {
            const grid = document.getElementById('villasGrid');
            
            if (filteredVillas.length === 0) {
                grid.innerHTML = '<div class="glass-card"><h3>Aucune villa trouvée</h3><p>Essayez de modifier vos critères de recherche.</p></div>';
                return;
            }

            grid.innerHTML = filteredVillas.map(villa => {
                const priceUnit = villa.priceUnit || '€/nuit';
                return `
                    <div class="villa-card">
                        <div class="villa-image-container" style="height: 200px; overflow: hidden;">
                            <img 
                                src="${villa.image}" 
                                alt="${villa.name}"
                                class="villa-image"
                                onclick="openImageGallery(${villa.id}, 0)"
                                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                                onload="this.nextElementSibling.style.display='none';"
                            >
                            <div class="image-placeholder" style="display: none;" onclick="openImageGallery(${villa.id}, 0)">
                                ${villa.fallbackIcon}
                            </div>
                        </div>
                        <div class="villa-content">
                            <h3>${villa.name}</h3>
                            <p><i class="fas fa-map-marker-alt"></i> ${villa.location}</p>
                            <p><i class="fas fa-users"></i> ${villa.guestsDetail}</p>
                            <p><i class="fas fa-swimming-pool"></i> ${villa.features}</p>
                            <div class="price">${villa.price} ${priceUnit}</div>
                            <div class="villa-buttons">
                                <button class="btn-primary" onclick="openReservationModal(${villa.id})">Réserver</button>
                                <button class="btn-secondary" onclick="viewDetails(${villa.id})">Détails</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // ===== RÉINITIALISER L'INTERSECTION OBSERVER POUR LES NOUVELLES VILLAS =====
            // Attendre un petit délai pour que les éléments soient dans le DOM
            setTimeout(() => {
                // Observer toutes les nouvelles villas
                const newVillaCards = document.querySelectorAll('.villa-card');
                console.log(`🔍 Observing ${newVillaCards.length} villa cards`);
                newVillaCards.forEach((card, index) => {
                    // Définir l'observer directement ici si pas encore défini
                    if (typeof observer !== 'undefined') {
                        observer.observe(card);
                        
                        // Vérifier immédiatement si la villa est déjà visible (pour les premières villas)
                        const rect = card.getBoundingClientRect();
                        const windowHeight = window.innerHeight || document.documentElement.clientHeight;
                        
                        // Si la villa est déjà dans le viewport, l'animer immédiatement
                        if (rect.top < windowHeight && rect.bottom > 0) {
                            setTimeout(() => {
                                card.classList.add('visible');
                            }, index * 100); // Délai progressif pour un effet staggeré
                        }
                    }
                });
            }, 200);
        }

        // Redirection vers page de réservation moderne
        function openReservationModal(villaId) {
            const villa = villasData.find(v => v.id === villaId);
            if (villa) {
                // Construire l'URL avec les paramètres de la villa
                const params = new URLSearchParams({
                    villa: villa.name,
                    price: villa.price,
                    location: villa.location
                });
                
                // Rediriger vers la page de réservation
                window.location.href = `reservation.html?${params.toString()}`;
            }
        }

        function closeReservationModal() {
            document.getElementById('reservationModal').classList.remove('active');
            document.getElementById('reservationForm').reset();
            document.getElementById('priceCalculation').style.display = 'none';
        }

        function calculatePrice() {
            if (!currentVilla) return;
            
            const checkinDate = modalCheckinCalendar.selectedDates[0];
            const checkoutDate = modalCheckoutCalendar.selectedDates[0];
            
            if (checkinDate && checkoutDate && checkinDate < checkoutDate) {
                const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
                const totalPrice = nights * currentVilla.price;
                
                document.getElementById('summaryVillaName').textContent = currentVilla.name;
                document.getElementById('summaryDates').textContent = 
                    `${checkinDate.toLocaleDateString('fr-FR')} - ${checkoutDate.toLocaleDateString('fr-FR')}`;
                document.getElementById('summaryNights').textContent = `${nights} nuit${nights > 1 ? 's' : ''}`;
                document.getElementById('summaryPricePerNight').textContent = `${currentVilla.price}€`;
                document.getElementById('summaryTotal').textContent = `${totalPrice}€`;
                
                document.getElementById('priceCalculation').style.display = 'block';
            } else {
                document.getElementById('priceCalculation').style.display = 'none';
            }
        }

        // Galerie d'images
        function openImageGallery(villaId, imageIndex = 0) {
            const villa = villasData.find(v => v.id === villaId);
            if (!villa || !villa.gallery) return;
            
            currentGallery = villa.gallery;
            currentGalleryIndex = imageIndex;
            
            updateGalleryImage();
            updateThumbnails();
            
            document.getElementById('imageGalleryModal').classList.add('active');
        }

        function closeImageGallery() {
            document.getElementById('imageGalleryModal').classList.remove('active');
        }

        function previousImage() {
            currentGalleryIndex = (currentGalleryIndex - 1 + currentGallery.length) % currentGallery.length;
            updateGalleryImage();
            updateThumbnails();
        }

        function nextImage() {
            currentGalleryIndex = (currentGalleryIndex + 1) % currentGallery.length;
            updateGalleryImage();
            updateThumbnails();
        }

        function goToImage(index) {
            currentGalleryIndex = index;
            updateGalleryImage();
            updateThumbnails();
        }

        function updateGalleryImage() {
            document.getElementById('galleryImage').src = currentGallery[currentGalleryIndex];
        }

        function updateThumbnails() {
            const thumbnailsContainer = document.getElementById('galleryThumbnails');
            thumbnailsContainer.innerHTML = currentGallery.map((image, index) => 
                `<img src="${image}" alt="Image KhanelConcept" class="thumbnail ${index === currentGalleryIndex ? 'active' : ''}" onclick="goToImage(${index})">`
            ).join('');
        }

        // Fonctions d'actions
        function getVillaPageUrl(villaId) {
            // Correspondance CORRIGÉE entre les IDs des villas et les NOUVELLES pages HTML créées
            const villaPageMapping = {
                1: "villa-villa-f3-sur-petit-macabou.html",                    // Villa F3 Petit Macabou
                2: "villa-villa-f5-sur-ste-anne.html",                         // Villa F5 Ste Anne
                3: "villa-villa-f3-pour-la-baccha.html",                       // Villa F3 POUR LA BACCHA
                4: "villa-villa-f6-au-lamentin.html",                          // Villa F6 Lamentin
                5: "villa-villa-f6-sur-ste-luce-a-1mn-de-la-plage.html",      // Villa F6 Ste Luce à 1mn de la plage
                6: "villa-villa-f6-sur-petit-macabou-sejour--fte.html",       // Villa F6 Petit Macabou (séjour + fête)
                7: "villa-villa-f7-baie-des-mulets.html",                     // Villa F7 Baie des Mulets
                8: "villa-villa-f3-bas-de-villa-trinite-cosmy.html",          // Bas de villa F3 Trinité Cosmy
                9: "villa-bas-de-villa-f3-sur-le-robert.html",                // Bas de villa F3 sur le Robert
                10: "villa-villa-f5-la-renee.html",                           // Villa F5 La Renée
                11: "villa-villa-f3-sur-le-franois.html",                     // Villa F3 sur le François
                12: "villa-villa-f5-vauclin-ravine-plate.html",               // Villa F5 Vauclin Ravine Plate
                13: "villa-bas-de-villa-f3-sur-ste-luce.html",                // Bas de villa F3 sur Ste Luce
                14: "villa-appartement-f3-trenelle-location-annuelle.html",   // Appartement F3 Trenelle
                15: "villa-studio-cocooning-lamentin.html",                   // Studio Cocooning Lamentin
                16: "villa-espace-piscine-journee-bungalow.html",             // Espace Piscine Journée Bungalow
                17: "villa-villa-fte-journee-ducos.html",                     // Villa Fête Journée Ducos
                18: "villa-villa-fte-journee-fort-de-france.html",            // Villa Fête Journée Fort de France
                19: "villa-villa-fte-journee-riviere-pilote.html",            // Villa Fête Journée Rivière-Pilote
                20: "villa-villa-fte-journee-sainte-luce.html",               // Villa Fête Journée Sainte-Luce
                21: "villa-villa-fte-journee-riviere-salee.html"              // Villa Fête Journée Rivière Salée
            };
            
            return villaPageMapping[villaId] || 'index.html';
        }

        function viewDetails(villaId) {
            console.log('🏠 Navigation vers villa:', villaId);
            
            // Afficher un loader immédiatement
            const clickedBtn = event.target;
            if (clickedBtn) {
                clickedBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Chargement...';
                clickedBtn.disabled = true;
            }
            
            // Correspondance corrigée - utilise getVillaPageUrl pour les IDs numériques
            if (typeof villaId === 'number' || !isNaN(villaId)) {
                const targetPage = getVillaPageUrl(parseInt(villaId));
                console.log('✅ Redirection immédiate vers:', targetPage);
                
                // Navigation immédiate sans délai
                setTimeout(() => {
                    window.location.href = './' + targetPage;
                }, 100); // Délai minimal pour l'effet visuel
                return;
            }
            
            // Pour les anciens IDs string (fallback)
            const villaPages = {
                'villa-f3-petit-macabou': 'villa-villa-f3-sur-petit-macabou.html',
                'villa-f3-baccha': 'villa-villa-f3-pour-la-baccha.html', 
                'villa-f3-francois': 'villa-villa-f3-sur-le-franois.html',
                'villa-f5-ste-anne': 'villa-villa-f5-sur-ste-anne.html',
                'villa-f6-lamentin': 'villa-villa-f6-au-lamentin.html',
                'villa-f6-ste-luce': 'villa-villa-f6-sur-ste-luce-a-1mn-de-la-plage.html',
                'villa-f3-trinite': 'villa-villa-f3-bas-de-villa-trinite-cosmy.html',
                'villa-f3-robert': 'villa-bas-de-villa-f3-sur-le-robert.html',
                'villa-f3-trenelle': 'villa-appartement-f3-trenelle-location-annuelle.html',
                'villa-f5-vauclin': 'villa-villa-f5-vauclin-ravine-plate.html',
                'villa-f5-la-renee': 'villa-villa-f5-la-renee.html',
                'villa-f7-baie-mulets': 'villa-villa-f7-baie-des-mulets.html',
                'villa-f3-ste-luce': 'villa-bas-de-villa-f3-sur-ste-luce.html',
                'villa-studio-lamentin': 'villa-studio-cocooning-lamentin.html',
                'villa-fete-ducos': 'villa-villa-fte-journee-ducos.html',
                'villa-fete-fort-de-france': 'villa-villa-fte-journee-fort-de-france.html',
                'villa-fete-riviere-pilote': 'villa-villa-fte-journee-riviere-pilote.html',
                'villa-fete-riviere-salee': 'villa-villa-fte-journee-riviere-salee.html',
                'villa-fete-sainte-luce': 'villa-villa-fte-journee-sainte-luce.html',
                'villa-espace-piscine': 'villa-espace-piscine-journee-bungalow.html',
                'villa-f6-petit-macabou-fete': 'villa-villa-f6-sur-petit-macabou-sejour--fte.html'
            };
            
            const targetPage = villaPages[villaId];
            if (targetPage) {
                console.log('✅ Redirection rapide vers:', targetPage);
                setTimeout(() => {
                    window.location.href = './' + targetPage;
                }, 100);
            } else {
                console.log('❌ Villa non trouvée:', villaId);
                if (clickedBtn) {
                    clickedBtn.innerHTML = '❌ Erreur';
                    setTimeout(() => window.location.reload(), 1000);
                }
            }
        }

        function contactPrestataire(service) {
            showStatusMessage(`Redirection vers ${service}...`, 'loading');
            
            setTimeout(() => {
                alert(`Service ${service}\n\nContactez-nous pour plus d'informations :\n📞 +596 696 XX XX XX\n📧 contact@khanelconcept.com`);
                showStatusMessage(`Contact ${service} - Formulaire affiché`, 'success');
            }, 1000);
        }

        function showComingSoon() {
            showStatusMessage('Fonctionnalité en cours de développement...', 'loading');
            
            setTimeout(() => {
                alert('Cette fonctionnalité sera bientôt disponible !\n\nRestez connecté pour les nouveautés.');
                showStatusMessage('Fonctionnalité à venir - Notification envoyée', 'success');
            }, 1000);
        }

        // 📊 CORRECTION PHASE 1: Fonction d'affichage de statut améliorée
        function showStatusMessage(message, type = 'info') {
            // Supprimer les anciens messages
            const existingStatus = document.querySelector('.search-status-message');
            if (existingStatus) {
                existingStatus.remove();
            }
            
            // Créer le nouveau message
            const statusDiv = document.createElement('div');
            statusDiv.className = 'search-status-message';
            
            const colors = {
                'loading': '#3b82f6',
                'success': '#10b981',
                'error': '#ef4444',
                'info': '#6b7280'
            };
            
            const icons = {
                'loading': '⏳',
                'success': '✅',
                'error': '❌',
                'info': 'ℹ️'
            };
            
            statusDiv.style.cssText = `
                position: fixed;
                top: 150px;
                left: 50%;
                transform: translateX(-50%);
                background: ${colors[type]};
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                font-weight: 600;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 1000;
                animation: slideInDown 0.3s ease;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            `;
            
            statusDiv.innerHTML = `${icons[type]} ${message}`;
            
            document.body.appendChild(statusDiv);
            
            // Supprimer automatiquement après 4 secondes (sauf loading)
            if (type !== 'loading') {
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.style.animation = 'slideOutUp 0.3s ease';
                        setTimeout(() => statusDiv.remove(), 300);
                    }
                }, 4000);
            }
        }
        
        // Ajouter les animations CSS pour les messages
        if (!document.querySelector('#search-status-animations')) {
            const style = document.createElement('style');
            style.id = 'search-status-animations';
            style.textContent = `
                @keyframes slideInDown {
                    from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
                
                @keyframes slideOutUp {
                    from { transform: translateX(-50%) translateY(0); opacity: 1; }
                    to { transform: translateX(-50%) translateY(-20px); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        // Gestion du formulaire de réservation
        document.getElementById('reservationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                villa: currentVilla.name,
                villaId: currentVilla.id,
                customerName: document.getElementById('customerName').value,
                customerEmail: document.getElementById('customerEmail').value,
                customerPhone: document.getElementById('customerPhone').value,
                checkin: modalCheckinCalendar.selectedDates[0]?.toLocaleDateString('fr-FR'),
                checkout: modalCheckoutCalendar.selectedDates[0]?.toLocaleDateString('fr-FR'),
                guests: document.getElementById('modalGuests').value,
                message: document.getElementById('customerMessage').value,
                total: document.getElementById('summaryTotal')?.textContent || 'N/A'
            };
            
            showStatusMessage('Traitement de votre réservation...', 'loading');
            
            // Simuler l'envoi de la réservation
            setTimeout(() => {
                showStatusMessage('Réservation confirmée ! Un email de confirmation va vous être envoyé.', 'success');
                
                // Afficher un résumé détaillé
                alert(`✅ Réservation confirmée !\n\n🏖️ Villa: ${formData.villa}\n👤 Client: ${formData.customerName}\n📧 Email: ${formData.customerEmail}\n📞 Téléphone: ${formData.customerPhone}\n📅 Du ${formData.checkin} au ${formData.checkout}\n👥 ${formData.guests} voyageurs\n💰 Total: ${formData.total}\n\n📧 Un email de confirmation va vous être envoyé avec tous les détails.\n📞 Notre équipe vous contactera dans les plus brefs délais.`);
                
                closeReservationModal();
            }, 2000);
        });

        // Gestion des événements clavier pour la galerie
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('imageGalleryModal').classList.contains('active')) {
                if (e.key === 'ArrowLeft') previousImage();
                if (e.key === 'ArrowRight') nextImage();
                if (e.key === 'Escape') closeImageGallery();
            }
            
            if (document.getElementById('reservationModal').classList.contains('active')) {
                if (e.key === 'Escape') closeReservationModal();
            }
        });

        // Fermer les modales en cliquant à l'extérieur
        window.onclick = function(event) {
            const reservationModal = document.getElementById('reservationModal');
            const galleryModal = document.getElementById('imageGalleryModal');
            
            if (event.target === reservationModal) {
                closeReservationModal();
            }
            
            if (event.target === galleryModal) {
                closeImageGallery();
            }
        }
        
        // =====================================================
        // HEADER SCROLL EFFECT PROFESSIONNEL
        // =====================================================
        
        window.addEventListener('scroll', function() {
            const header = document.querySelector('.header');
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // =====================================================
        // NAVIGATION MOBILE HAMBURGER
        // =====================================================
        
        // Navigation mobile intelligente - CORRIGÉE
        function toggleMobileMenu() {
            const navMenu = document.querySelector('.nav-links.nav-menu'); // Double classe
            const toggle = document.querySelector('.mobile-nav-toggle i');
            
            console.log('🍔 Toggle menu - Current state:', navMenu.classList.contains('mobile-open'));
            
            if (navMenu.classList.contains('mobile-open')) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        }
        
        function openMobileMenu() {
            const navMenu = document.querySelector('.nav-links.nav-menu'); // Double classe
            const toggle = document.querySelector('.mobile-nav-toggle i');
            
            navMenu.classList.add('mobile-open');
            toggle.className = 'fas fa-times';
            
            // Animation staggered pour les liens
            const menuLinks = navMenu.querySelectorAll('a');
            menuLinks.forEach((link, index) => {
                link.style.opacity = '0';
                link.style.transform = 'translateY(20px)';
                link.style.animation = `slideInStagger 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) ${index * 0.05}s forwards`;
            });
            
            // Fermer le menu lors du clic sur un lien
            menuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    closeMobileMenu();
                    
                    // Si c'est un lien href (comme SOS Dépannage), laisser la navigation normale
                    if (link.getAttribute('href') && link.getAttribute('href') !== '#') {
                        // Navigation normale vers la page (pas de preventDefault)
                        return;
                    }
                    
                    // Pour les autres liens avec onclick, petit délai avant exécution
                    if (link.getAttribute('onclick')) {
                        setTimeout(() => {
                            eval(link.getAttribute('onclick'));
                        }, 200);
                    }
                });
            });
            
            // Fermer le menu si clic à l'extérieur
            setTimeout(() => {
                document.addEventListener('click', handleOutsideClick);
            }, 100);
        }
        
        function closeMobileMenu() {
            const navMenu = document.querySelector('.nav-links.nav-menu'); // Double classe
            const toggle = document.querySelector('.mobile-nav-toggle i');
            
            console.log('❌ Fermeture menu mobile');
            
            // Animation de sortie pour les liens
            const menuLinks = navMenu.querySelectorAll('a');
            menuLinks.forEach((link, index) => {
                link.style.animation = `slideOutStagger 0.3s cubic-bezier(0.55, 0.085, 0.68, 0.53) ${index * 0.03}s forwards`;
            });
            
            // Fermer le menu après l'animation
            setTimeout(() => {
                navMenu.classList.remove('mobile-open');
                toggle.className = 'fas fa-bars';
                
                // Reset des styles inline
                menuLinks.forEach(link => {
                    link.style.animation = '';
                    link.style.opacity = '';
                    link.style.transform = '';
                });
            }, 300);
            
            document.removeEventListener('click', handleOutsideClick);
        }
        
        function handleOutsideClick(event) {
            const navMenu = document.querySelector('.nav-links.nav-menu'); // Double classe
            const toggleBtn = document.querySelector('.mobile-nav-toggle');
            
            if (!navMenu.contains(event.target) && !toggleBtn.contains(event.target)) {
                closeMobileMenu();
            }
        }
        
        // Optimisations tactiles pour mobile
        function optimizeForTouch() {
            // Améliorer feedback tactile sur tous les boutons
            const buttons = document.querySelectorAll('button, .btn, [onclick]');
            
            buttons.forEach(btn => {
                // Ajouter des états tactiles
                btn.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.95)';
                    this.style.transition = 'transform 0.1s ease';
                });
                
                btn.addEventListener('touchend', function() {
                    this.style.transform = 'scale(1)';
                });
                
                // S'assurer que les boutons ont une taille minimale sur mobile
                if (window.innerWidth <= 768) {
                    btn.style.minHeight = '44px';
                    btn.style.minWidth = '44px';
                }
            });
        }
        
        // Prévenir le zoom sur les inputs iOS
        function preventIOSZoom() {
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (window.innerWidth <= 768) {
                    input.style.fontSize = '16px';
                }
            });
        }
        
        // Initialisation des optimisations mobiles
        document.addEventListener('DOMContentLoaded', function() {
            optimizeForTouch();
            preventIOSZoom();
            initBackgroundVideoiOS();
            forceMobileNavigation(); // CRITIQUE : Force masquage nav mobile
            
            // Réinitialiser le menu mobile lors du redimensionnement
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    const navMenu = document.querySelector('.nav-menu');
                    navMenu.style.display = '';
                    navMenu.style.position = '';
                    navMenu.style.background = '';
                    navMenu.style.padding = '';
                } else {
                    forceMobileNavigation();
                }
            });
        });
        
        // SOLUTION RADICALE : Force navigation mobile via JavaScript
        function forceMobileNavigation() {
            if (window.innerWidth <= 768) {
                console.log("🔧 FORCE NAVIGATION MOBILE");
                
                // Masquer tous les éléments de navigation desktop
                const navElements = [
                    '.nav-links',
                    '.nav-menu', 
                    'nav.nav-links',
                    'nav.nav-menu',
                    '.header-content .nav-links',
                    '.header-content nav'
                ];
                
                navElements.forEach(selector => {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => {
                        el.style.display = 'none';
                        el.style.visibility = 'hidden';
                        el.style.opacity = '0';
                        el.style.position = 'absolute';
                        el.style.left = '-9999px';
                    });
                });
                
                // Forcer l'affichage du bouton hamburger
                const hamburgerBtn = document.querySelector('.mobile-nav-toggle');
                if (hamburgerBtn) {
                    hamburgerBtn.style.display = 'block';
                    hamburgerBtn.style.visibility = 'visible';
                    hamburgerBtn.style.opacity = '1';
                    hamburgerBtn.style.position = 'relative';
                    hamburgerBtn.style.left = 'auto';
                    console.log("✅ Bouton hamburger affiché");
                } else {
                    console.log("❌ Bouton hamburger non trouvé");
                }
                
                // Forcer layout header mobile
                const headerContent = document.querySelector('.header-content');
                if (headerContent) {
                    headerContent.style.display = 'flex';
                    headerContent.style.flexDirection = 'row';
                    headerContent.style.justifyContent = 'space-between';
                    headerContent.style.alignItems = 'center';
                    headerContent.style.textAlign = 'left';
                    console.log("✅ Header layout mobile forcé");
                }
                
                console.log("🎯 Navigation mobile forcée via JavaScript");
            }
        }
        
        // 🎬 CORRECTION PHASE 1: Gestion vidéo d'arrière-plan optimisée avec fallback
        function initBackgroundVideoOptimized() {
            const video = document.getElementById('backgroundVideo');
            if (!video) return;
            
            console.log('🎬 Initialisation vidéo d\'arrière-plan optimisée');
            
            // Détecter le type de navigateur
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            
            // Configuration optimisée selon le navigateur
            if (isIOS) {
                video.setAttribute('webkit-playsinline', '');
                video.setAttribute('playsinline', '');
                video.muted = true;
                video.defaultMuted = true;
                video.volume = 0;
                console.log('📱 Configuration iOS appliquée');
            }
            
            // Gestion des erreurs de chargement
            video.addEventListener('error', function(e) {
                console.warn('⚠️ Erreur vidéo, passage au fallback image');
                showVideoFallback();
            });
            
            // Gestion du chargement
            video.addEventListener('loadstart', function() {
                console.log('🔄 Chargement vidéo démarré');
            });
            
            video.addEventListener('canplay', function() {
                console.log('✅ Vidéo prête à être lue');
                video.style.opacity = '1';
            });
            
            // Tentative de lecture
            const playVideo = () => {
                return video.play().then(() => {
                    console.log('✅ Lecture vidéo réussie');
                    return true;
                }).catch(error => {
                    console.warn('⚠️ Autoplay bloqué:', error.name);
                    
                    // Pour les navigateurs bloquant l'autoplay
                    if (error.name === 'NotAllowedError') {
                        // Démarrer au premier interaction
                        const startOnInteraction = () => {
                            video.play().then(() => {
                                console.log('✅ Vidéo démarrée après interaction');
                            }).catch(err => {
                                console.error('❌ Impossible de lire la vidéo:', err);
                                showVideoFallback();
                            });
                            document.removeEventListener('touchstart', startOnInteraction);
                            document.removeEventListener('click', startOnInteraction);
                        };
                        
                        document.addEventListener('touchstart', startOnInteraction, { once: true });
                        document.addEventListener('click', startOnInteraction, { once: true });
                        
                        // Afficher une indication visuelle
                        showPlayButton();
                        return false;
                    } else {
                        // Autres erreurs : utiliser le fallback
                        showVideoFallback();
                        return false;
                    }
                });
            };
            
            // Démarrer la lecture après un court délai
            setTimeout(playVideo, 100);
        }
        
        // Fonction pour afficher l'image de fallback
        function showVideoFallback() {
            const videoContainer = document.querySelector('.video-background');
            if (videoContainer) {
                videoContainer.style.backgroundImage = 'url("https://res.cloudinary.com/ddulasmtz/image/upload/v1752950782/villa-background-fallback.jpg")';
                videoContainer.style.backgroundSize = 'cover';
                videoContainer.style.backgroundPosition = 'center';
                videoContainer.style.backgroundRepeat = 'no-repeat';
                
                const video = videoContainer.querySelector('video');
                if (video) {
                    video.style.display = 'none';
                }
                
                console.log('🖼️ Fallback image activé');
            }
        }
        
        // Fonction pour afficher un bouton play temporaire
        function showPlayButton() {
            const videoContainer = document.querySelector('.video-background');
            if (videoContainer && !videoContainer.querySelector('.play-button')) {
                const playBtn = document.createElement('div');
                playBtn.className = 'play-button';
                playBtn.innerHTML = '▶️';
                playBtn.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 4rem;
                    background: rgba(255, 255, 255, 0.2);
                    border-radius: 50%;
                    width: 100px;
                    height: 100px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    z-index: 10;
                    transition: all 0.3s ease;
                `;
                
                playBtn.addEventListener('click', () => {
                    const video = document.getElementById('backgroundVideo');
                    if (video) {
                        video.play().then(() => {
                            playBtn.remove();
                        });
                    }
                });
                
                videoContainer.appendChild(playBtn);
            }
        }
        
        // Remplacer l'ancienne fonction iOS par la nouvelle
        function initBackgroundVideoiOS() {
            initBackgroundVideoOptimized();
        }
        
        // Configuration tactile spéciale mobile pour INDEX
        function setupMobileDateFieldsIndex() {
            const isMobile = window.innerWidth <= 768;
            if (!isMobile) return;
            
            console.log("🔧 Configuration tactile mobile INDEX");
            
            const checkinField = document.getElementById('checkin');
            const checkoutField = document.getElementById('checkout');
            
            [checkinField, checkoutField].forEach(field => {
                if (field) {
                    console.log("📱 Configuration tactile pour:", field.id);
                    
                    // Supprimer readonly pour permettre le focus
                    field.removeAttribute('readonly');
                    
                    // Événement touchstart pour iOS
                    field.addEventListener('touchstart', function(e) {
                        console.log("👆 Touch détecté sur", this.id);
                        e.preventDefault();
                        
                        // Force l'ouverture du calendrier
                        setTimeout(() => {
                            if (this.id === 'checkin' && checkinCalendar) {
                                console.log("📅 Ouverture calendrier arrivée");
                                checkinCalendar.open();
                            } else if (this.id === 'checkout' && checkoutCalendar) {
                                console.log("📅 Ouverture calendrier départ");
                                checkoutCalendar.open();
                            }
                        }, 100);
                    }, { passive: false });
                    
                    // Événement click pour compatibilité
                    field.addEventListener('click', function(e) {
                        console.log("🖱️ Clic détecté sur", this.id);
                        e.preventDefault();
                        
                        if (this.id === 'checkin' && checkinCalendar) {
                            checkinCalendar.open();
                        } else if (this.id === 'checkout' && checkoutCalendar) {
                            checkoutCalendar.open();
                        }
                    });
                    
                    // Événement focus
                    field.addEventListener('focus', function() {
                        console.log("🎯 Focus sur", this.id);
                        
                        setTimeout(() => {
                            if (this.id === 'checkin' && checkinCalendar) {
                                checkinCalendar.open();
                            } else if (this.id === 'checkout' && checkoutCalendar) {
                                checkoutCalendar.open();
                            }
                        }, 50);
                    });
                }
            });
        }
        function smoothScrollMobile(elementId, offset = 100) {
            const element = document.getElementById(elementId);
            if (element && window.innerWidth <= 768) {
                const elementPosition = element.offsetTop - offset;
                window.scrollTo({
                    top: elementPosition,
                    behavior: 'smooth'
                });
            }
        }
        
        // ==========================================
        // Gestion de l'espace membre dans la navigation
        // ==========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            checkMemberStatus();
        });
        
        function checkMemberStatus() {
            const userData = localStorage.getItem('khanelconcept_user');
            const token = localStorage.getItem('khanelconcept_token');
            const memberLinksContainer = document.querySelector('.member-links');
            
            if (userData && token) {
                try {
                    const user = JSON.parse(userData);
                    displayMemberDashboard(user);
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    displayGuestLinks();
                }
            } else {
                displayGuestLinks();
            }
        }
        
        function displayMemberDashboard(user) {
            const memberLinksContainer = document.querySelector('.member-links');
            const firstName = user.firstName || 'Membre';
            const level = user.level || 'Découvreur';
            const points = user.points || 0;
            
            memberLinksContainer.innerHTML = `
                <a href="dashboard.html" class="member-link dashboard-link">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <div class="member-profile-preview">
                    <div class="member-avatar">${firstName.charAt(0).toUpperCase()}</div>
                    <div class="member-info">
                        <div class="member-name">${firstName}</div>
                        <div class="member-level">${level} • ${points}pts</div>
                    </div>
                </div>
                <button class="member-link logout-link" onclick="logoutMember()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Déconnexion</span>
                </button>
                <div class="member-separator"></div>
            `;
        }
        
        function displayGuestLinks() {
            const memberLinksContainer = document.querySelector('.member-links');
            memberLinksContainer.innerHTML = `
                <a href="login.html" class="member-link login-link">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Connexion</span>
                </a>
                <a href="register.html" class="member-link register-link">
                    <i class="fas fa-user-plus"></i>
                    <span>Inscription</span>
                </a>
                <div class="member-separator"></div>
            `;
        }
        
        function logoutMember() {
            if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                localStorage.removeItem('khanelconcept_user');
                localStorage.removeItem('khanelconcept_token');
                displayGuestLinks();
                // Optionnel: afficher un message de confirmation
                setTimeout(() => {
                    alert('Vous avez été déconnecté avec succès.');
                }, 100);
            }
        }
        
        // 🚀 CORRECTION PHASE 1: Optimisation des images et lazy loading
        function initImageOptimization() {
            console.log('🖼️ Initialisation optimisation images');
            
            // 1. Lazy loading natif pour toutes les images
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                if (!img.hasAttribute('loading')) {
                    img.setAttribute('loading', 'lazy');
                }
                
                // Fallback pour image cassée
                img.addEventListener('error', function() {
                    this.src = 'https://via.placeholder.com/400x300/667eea/ffffff?text=Villa+Image';
                    console.warn('🖼️ Image remplacée par fallback:', this.src);
                });
            });
            
            // 2. Optimisation des images villa avec WebP
            const villaImages = document.querySelectorAll('.villa-image, .hero-image, img[src*="villa"]');
            villaImages.forEach(img => {
                const originalSrc = img.src;
                
                // Vérifier le support WebP
                const supportsWebP = (function() {
                    const elem = document.createElement('canvas');
                    return !!(elem.getContext && elem.getContext('2d'));
                })();
                
                if (supportsWebP && originalSrc.includes('.jpg')) {
                    const webpSrc = originalSrc.replace('.jpg', '.webp');
                    
                    // Tester si l'image WebP existe
                    const testImg = new Image();
                    testImg.onload = function() {
                        img.src = webpSrc;
                        console.log('✅ Image WebP chargée:', webpSrc);
                    };
                    testImg.onerror = function() {
                        console.log('⚠️ WebP non disponible, garde JPG:', originalSrc);
                    };
                    testImg.src = webpSrc;
                }
            });
            
            // 3. Compression adaptative selon la connexion
            if ('connection' in navigator) {
                const connection = navigator.connection;
                if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
                    // Réduire la qualité pour connexions lentes
                    console.log('📶 Connexion lente détectée, optimisation renforcée');
                    
                    villaImages.forEach(img => {
                        if (img.src.includes('cloudinary.com')) {
                            // Ajouter paramètres Cloudinary pour compression
                            img.src = img.src.replace('/upload/', '/upload/q_60,f_auto,c_scale,w_800/');
                        }
                    });
                }
            }
            
            console.log(`🎯 ${images.length} images optimisées pour le chargement`);
        }
        
        // 📊 CORRECTION PHASE 1: Optimisation performance générale
        function initPerformanceOptimizations() {
            console.log('⚡ Optimisations performance appliquées');
            
            // 1. Préchargement critique
            const criticalResources = [
                'https://res.cloudinary.com/ddulasmtz/image/upload/v1752950782/villa-background-fallback.jpg'
            ];
            
            criticalResources.forEach(resource => {
                const link = document.createElement('link');
                link.rel = 'preload';
                link.href = resource;
                link.as = 'image';
                document.head.appendChild(link);
            });
            
            // 2. Minification CSS inline simple
            const styles = document.querySelectorAll('style');
            styles.forEach(style => {
                if (style.textContent.includes('/* MINIFY */')) {
                    style.textContent = style.textContent.replace(/\s+/g, ' ').replace(/;\s+/g, ';');
                }
            });
            
            // 3. Debounce pour events fréquents
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    // Logic de resize
                }, 150);
            });
            
            // 4. IntersectionObserver pour lazy loading avancé
            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            if (img.dataset.src) {
                                img.src = img.dataset.src;
                                img.removeAttribute('data-src');
                                observer.unobserve(img);
                            }
                        }
                    });
                });
                
                document.querySelectorAll('img[data-src]').forEach(img => {
                    observer.observe(img);
                });
            }
        }
        
        // ==========================================
        
        </script>
        
    <!-- 🚀 PHASE 1: Initialisation des optimisations -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Optimisations Phase 1 (après le contenu principal)
            setTimeout(() => {
                initImageOptimization();
                initPerformanceOptimizations();
            }, 500);
        });
    </script>

    <!-- Admin Access - Discreet Link -->
    <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <a href="./login.html" style="
            display: inline-block;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        " onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.color='white';" 
           onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.color='rgba(255, 255, 255, 0.8)';"
           title="Administration">
            ⚙️
        </a>
    </div>

    <!-- PHASE 4 - PERFORMANCE & RGPD Scripts -->
    <script src="js/cache-system.js"></script>
    <script src="js/pagination-system.js"></script>
    <script src="js/gdpr-consent.js"></script>
    
    <!-- PHASE 4 - Integration and Initialization -->
    <script>
        // Initialize Phase 4 systems
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize GDPR consent system
            if (window.gdprConsent) {
                // Check for consent and show banner if needed
                if (window.gdprConsent.shouldShowBanner()) {
                    window.gdprConsent.showBanner();
                }
                
                // Apply existing consent
                window.gdprConsent.applyConsent();
            }
            
            // Initialize cache system with Villa data
            if (window.CacheSystem && window.ApiClient) {
                // Pre-cache villa data for better performance
                cacheVillaData();
                
                // Show cache stats in console for debugging
                console.log('📊 Cache Stats:', window.CacheSystem.getStats());
            }
            
            // Initialize pagination for villa grid
            if (window.PaginationSystem && document.getElementById('villas-grid')) {
                initializeVillaPagination();
            }
            
            // Track page view for analytics (with consent check)
            if (window.gdprConsent && window.gdprConsent.hasConsent('analytics')) {
                trackPageView('index');
            }
        });
        
        // Cache villa data for better performance
        async function cacheVillaData() {
            try {
                // Cache villa list
                await window.ApiClient.get('/api/villas', { cache: 'static' });
                
                // Pre-cache popular villas
                const popularVillas = [1, 2, 3, 4, 5]; // Top 5 villa IDs
                for (const id of popularVillas) {
                    await window.ApiClient.get(`/api/villas/${id}`, { cache: 'static' });
                }
                
                console.log('✅ Villa data cached successfully');
            } catch (error) {
                console.warn('⚠️ Could not pre-cache villa data:', error);
            }
        }
        
        // Initialize pagination for villa grid
        function initializeVillaPagination() {
            const paginationSystem = new PaginationSystem();
            const villaGrid = document.getElementById('villas-grid');
            
            // Create pagination instance
            const pagination = paginationSystem.create('villa-pagination', {
                defaultPageSize: 12,
                showInfo: true,
                showSizeSelector: true,
                enableCache: true,
                cacheStrategy: 'user'
            });
            
            // Configure pagination for villas
            pagination.configure({
                fetchData: async (page, pageSize, filters) => {
                    const response = await window.ApiClient.post('/api/villas/search', {
                        page: page,
                        pageSize: pageSize,
                        filters: filters
                    }, { cache: 'user' });
                    
                    return {
                        items: response.villas || [],
                        total: response.total || 0
                    };
                },
                renderItem: (villa) => {
                    return createVillaCard(villa);
                },
                onPageChange: (page, data) => {
                    // Update URL without reload
                    const url = new URL(window.location);
                    url.searchParams.set('page', page);
                    window.history.pushState({}, '', url);
                    
                    // Track page change
                    if (window.gdprConsent && window.gdprConsent.hasConsent('analytics')) {
                        trackEvent('villa_page_change', { page: page });
                    }
                }
            });
            
            // Insert pagination container
            const paginationContainer = document.createElement('div');
            paginationContainer.id = 'villa-pagination';
            villaGrid.parentNode.insertBefore(paginationContainer, villaGrid.nextSibling);
            
            // Initialize with current villa data
            pagination.loadData();
        }
        
        // Create villa card HTML
        function createVillaCard(villa) {
            return `
                <div class="villa-card" data-category="${villa.category}">
                    <div class="villa-image">
                        <img src="${villa.image}" alt="${villa.name}" loading="lazy">
                    </div>
                    <div class="villa-info">
                        <h3>${villa.name}</h3>
                        <p class="location">${villa.location}</p>
                        <div class="price">${villa.price}€/nuit</div>
                        <div class="guests">${villa.guests} personnes</div>
                        <div class="features">${villa.features}</div>
                    </div>
                </div>
            `;
        }
        
        // Analytics tracking functions
        function trackPageView(page) {
            trackEvent('page_view', { page: page });
        }
        
        function trackEvent(eventType, metadata = {}) {
            if (!window.gdprConsent || !window.gdprConsent.hasConsent('analytics')) {
                return;
            }
            
            const sessionId = getSessionId();
            const memberId = localStorage.getItem('khanelconcept_member_id');
            
            fetch(`${getBackendUrl()}/api/analytics/track`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    event_type: eventType,
                    page: window.location.pathname,
                    session_id: sessionId,
                    member_id: memberId,
                    metadata: metadata,
                    consent: window.gdprConsent.getConsentData()
                })
            }).catch(error => {
                console.warn('Analytics tracking failed:', error);
            });
        }
        
        // Get or create session ID
        function getSessionId() {
            let sessionId = sessionStorage.getItem('khanelconcept_session_id');
            if (!sessionId) {
                sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('khanelconcept_session_id', sessionId);
            }
            return sessionId;
        }
        
        // Get backend URL
        function getBackendUrl() {
            return window.location.hostname === 'localhost' 
                ? 'http://localhost:8001'
                : 'https://luxury-stays-9.preview.emergentagent.com';
        }
        
        // Enhanced search function with cache and analytics
        window.searchVillas = async function(destination, guests, category) {
            // Track search event
            if (window.gdprConsent && window.gdprConsent.hasConsent('analytics')) {
                trackEvent('villa_search', { 
                    destination: destination, 
                    guests: guests, 
                    category: category 
                });
            }
            
            try {
                // Use cached API client
                const response = await window.ApiClient.post('/api/villas/search', {
                    destination: destination,
                    guests: guests,
                    category: category
                }, { cache: 'user' });
                
                // Display results
                displayVillas(response.villas);
                
                // Update search status
                const statusElement = document.getElementById('search-status');
                if (statusElement) {
                    statusElement.textContent = `${response.villas.length} villa(s) trouvée(s) !`;
                }
                
            } catch (error) {
                console.error('Search failed:', error);
                // Show error message
                const statusElement = document.getElementById('search-status');
                if (statusElement) {
                    statusElement.textContent = 'Erreur lors de la recherche';
                }
            }
        };
        
        // GDPR consent event listeners
        window.addEventListener('gdpr:acceptedAll', function() {
            console.log('✅ GDPR: All consent given');
            // Initialize analytics tracking
            trackPageView('index');
        });
        
        window.addEventListener('gdpr:rejectedAll', function() {
            console.log('❌ GDPR: All consent rejected');
            // Disable analytics features
            if (window.CacheSystem) {
                window.CacheSystem.configure({ enablePersistence: false });
            }
        });
        
        window.addEventListener('gdpr:categoryToggled', function(event) {
            console.log('🔄 GDPR: Category toggled', event.detail);
            if (event.detail.category === 'analytics' && event.detail.enabled) {
                trackPageView('index');
            }
        });
        
        // Performance monitoring
        window.addEventListener('load', function() {
            // Track page load time
            const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            
            if (window.gdprConsent && window.gdprConsent.hasConsent('analytics')) {
                trackEvent('page_load_time', { 
                    load_time: loadTime,
                    page: 'index'
                });
            }
            
            // Cache performance metrics
            setTimeout(() => {
                if (window.CacheSystem) {
                    const stats = window.CacheSystem.getStats();
                    console.log('📊 Cache Performance:', stats);
                }
            }, 1000);
        });
    </script>
</body>
</html>