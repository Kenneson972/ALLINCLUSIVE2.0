<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>üîç Diagnostic GitHub Pages - KhanelConcept</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        .diagnostic-box {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            max-width: 800px;
        }
        .success { color: #00ff88; }
        .error { color: #ff6b6b; }
        .warning { color: #ffa500; }
        .info { color: #4facfe; }
        .timestamp {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 10px;
        }
        pre {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            overflow-x: auto;
            font-size: 0.9rem;
        }
        .test-result {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            margin: 5px;
            font-weight: bold;
        }
        .test-success { background: rgba(0,255,136,0.3); }
        .test-error { background: rgba(255,107,107,0.3); }
        .test-warning { background: rgba(255,165,0,0.3); }
    </style>
</head>
<body>
    <h1>üîç Diagnostic GitHub Pages - KhanelConcept</h1>
    <p><strong>Objectif :</strong> Identifier pourquoi GitHub Pages affiche 3 villas au lieu de 21</p>
    
    <div class="diagnostic-box">
        <h2>üìã Tests en cours...</h2>
        <div id="results"></div>
    </div>

    <div class="diagnostic-box">
        <h3>üìä Donn√©es d√©tect√©es :</h3>
        <div id="dataInfo"></div>
    </div>

    <div class="diagnostic-box">
        <h3>üîß Actions recommand√©es :</h3>
        <div id="recommendations"></div>
    </div>

    <script>
        const results = document.getElementById('results');
        const dataInfo = document.getElementById('dataInfo');
        const recommendations = document.getElementById('recommendations');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result test-${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        function addInfo(html) {
            dataInfo.innerHTML += html + '<br>';
        }

        function addRecommendation(html) {
            recommendations.innerHTML += '‚Ä¢ ' + html + '<br>';
        }

        // Tests de diagnostic
        setTimeout(() => {
            console.log("üöÄ D√©marrage des tests de diagnostic...");

            // Test 1: V√©rifier si on est sur GitHub Pages
            const isGitHubPages = window.location.hostname.includes('github.io');
            addResult(`GitHub Pages: ${isGitHubPages ? 'OUI' : 'LOCAL'}`, isGitHubPages ? 'success' : 'info');

            // Test 2: V√©rifier le localStorage
            const localStorageWorks = (() => {
                try {
                    localStorage.setItem('test', 'ok');
                    const result = localStorage.getItem('test') === 'ok';
                    localStorage.removeItem('test');
                    return result;
                } catch(e) {
                    return false;
                }
            })();
            addResult(`localStorage: ${localStorageWorks ? 'OK' : 'ERREUR'}`, localStorageWorks ? 'success' : 'error');

            // Test 3: V√©rifier les donn√©es admin dans localStorage
            const adminData = localStorage.getItem('khanelconcept_villas');
            if (adminData) {
                try {
                    const parsed = JSON.parse(adminData);
                    addResult(`Donn√©es admin: ${parsed.length} villas`, 'success');
                    addInfo(`<strong>Donn√©es admin trouv√©es:</strong> ${parsed.length} villas dans localStorage`);
                    addInfo(`<strong>Premi√®re villa:</strong> ${parsed[0]?.name || 'N/A'}`);
                    addInfo(`<strong>Derni√®re villa:</strong> ${parsed[parsed.length - 1]?.name || 'N/A'}`);
                } catch(e) {
                    addResult('Donn√©es admin: CORROMPUES', 'error');
                    addInfo('<strong class="error">Donn√©es admin corrompues dans localStorage</strong>');
                }
            } else {
                addResult('Donn√©es admin: ABSENTES', 'warning');
                addInfo('<strong class="warning">Aucune donn√©e admin dans localStorage</strong>');
            }

            // Test 4: V√©rifier le fichier index.html actuel
            fetch(window.location.href)
                .then(response => response.text())
                .then(html => {
                    const has21Villas = html.includes('Villa F√™te Rivi√®re-Sal√©e') || html.includes('21 villas') || html.includes('id: 21');
                    const hasLocalStorageLogic = html.includes('khanelconcept_villas') || html.includes('syncedData');
                    const hasOldLogic = html.includes('const villasData = [') && !html.includes('let villasData = []');
                    
                    addResult(`21 villas dans HTML: ${has21Villas ? 'OUI' : 'NON'}`, has21Villas ? 'success' : 'error');
                    addResult(`Logique localStorage: ${hasLocalStorageLogic ? 'OUI' : 'NON'}`, hasLocalStorageLogic ? 'success' : 'error');
                    addResult(`Ancien code (probl√®me): ${hasOldLogic ? 'OUI' : 'NON'}`, hasOldLogic ? 'error' : 'success');

                    addInfo(`<strong>Analyse index.html:</strong>`);
                    addInfo(`- Contient 21 villas: ${has21Villas}`);
                    addInfo(`- Utilise localStorage: ${hasLocalStorageLogic}`);
                    addInfo(`- Code ancien d√©tect√©: ${hasOldLogic}`);
                })
                .catch(e => {
                    addResult('Lecture HTML: ERREUR', 'error');
                });

            // Test 5: Tenter une synchronisation test
            try {
                const testVillas = [];
                for (let i = 1; i <= 21; i++) {
                    testVillas.push({
                        id: i,
                        name: `Villa Test ${i}`,
                        location: `Location ${i}`,
                        price: 800 + (i * 50),
                        guests: 6,
                        guestsDetail: `${i} personnes`,
                        features: `Test villa ${i}`,
                        category: 'sejour',
                        image: `./images/test${i}.jpg`,
                        fallbackIcon: 'üè®'
                    });
                }
                localStorage.setItem('khanelconcept_villas', JSON.stringify(testVillas));
                addResult('Test de sync: OK', 'success');
                addInfo('<strong class="success">Test de synchronisation effectu√© - 21 villas test cr√©√©es</strong>');
            } catch(e) {
                addResult('Test de sync: ERREUR', 'error');
                addInfo('<strong class="error">Erreur lors du test de synchronisation</strong>');
            }

            // Recommandations
            if (isGitHubPages) {
                if (!adminData) {
                    addRecommendation('Aller sur <a href="./admin/admin.html" style="color: #00ff88;">/admin/admin.html</a> et cliquer "Sync Site"');
                }
                addRecommendation('Vider le cache navigateur (Ctrl+Shift+Delete)');
                addRecommendation('Essayer en navigation priv√©e');
                addRecommendation('V√©rifier que le fichier index.html sur GitHub contient bien la logique localStorage');
            } else {
                addRecommendation('Utiliser "Save to GitHub" pour pousser les modifications');
                addRecommendation('V√©rifier que tous les fichiers modifi√©s sont bien committ√©s');
            }

            addRecommendation('Rafra√Æchir cette page apr√®s synchronisation admin');

            // Timestamp
            const timestamp = new Date().toLocaleString('fr-FR');
            addInfo(`<div class="timestamp">Diagnostic effectu√© le ${timestamp}</div>`);

            console.log("‚úÖ Diagnostic termin√©");
        }, 1000);
    </script>
</body>
</html>