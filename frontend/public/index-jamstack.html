<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhanelConcept - Plateforme Connect√©e | Villas de Luxe Martinique</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="D√©couvrez nos villas de luxe en Martinique. R√©servation en ligne avec galeries interactives, calendriers avanc√©s et syst√®me de r√©servation professionnel.">
    <meta name="keywords" content="villa martinique, location villa luxe, martinique vacances, villa piscine, s√©jour martinique">
    <meta name="author" content="KhanelConcept">
    <meta property="og:title" content="KhanelConcept - Villas de Luxe Martinique">
    <meta property="og:description" content="Plateforme moderne de r√©servation de villas de luxe en Martinique avec interface glassmorphism">
    <meta property="og:type" content="website">
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <!-- Custom CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Video Background */
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }
        
        .video-background video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            object-fit: cover;
        }
        
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: -1;
        }
        
        /* Glassmorphism Effects */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
        }
        
        .glass-strong {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
        }
        
        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 20px 0;
            transition: all 0.3s ease;
        }
        
        .header.scrolled {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 30px;
            margin: 0;
            padding: 0;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-menu a:hover {
            color: #ffd700;
            transform: translateY(-2px);
        }
        
        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: #ffd700;
            transition: width 0.3s ease;
        }
        
        .nav-menu a:hover::after {
            width: 100%;
        }
        
        /* Mobile Navigation */
        .mobile-menu-toggle {
            display: none;
            flex-direction: column;
            cursor: pointer;
            z-index: 1001;
        }
        
        .mobile-menu-toggle span {
            width: 25px;
            height: 3px;
            background: white;
            margin: 3px 0;
            transition: 0.3s;
        }
        
        .mobile-menu {
            position: fixed;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 999;
            transition: left 0.3s ease;
            padding: 100px 20px 20px;
        }
        
        .mobile-menu.active {
            left: 0;
        }
        
        .mobile-menu-items {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .mobile-menu-items li {
            margin: 20px 0;
        }
        
        .mobile-menu-items a {
            color: white;
            text-decoration: none;
            font-size: 1.5rem;
            font-weight: 500;
            display: block;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Main Content */
        .main-content {
            padding-top: 120px;
            padding-bottom: 60px;
        }
        
        .hero-section {
            text-align: center;
            padding: 60px 20px;
            margin-bottom: 60px;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .hero-subtitle {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 40px;
            font-weight: 300;
        }
        
        /* Search Section */
        .search-container {
            max-width: 1000px;
            margin: 0 auto 60px;
            padding: 0 20px;
        }
        
        .search-box {
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            color: white;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .form-group input,
        .form-group select {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .search-button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .search-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }
        
        /* API Status */
        .api-status {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .api-status.online {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .api-status.offline {
            background: rgba(255, 165, 0, 0.1);
            color: #ffa500;
            border: 1px solid rgba(255, 165, 0, 0.3);
        }
        
        .api-status.error {
            background: rgba(255, 0, 0, 0.1);
            color: #ff6b6b;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        /* Villa Grid */
        .villas-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .section-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 50px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .villas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }
        
        .villa-card {
            padding: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .villa-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .villa-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        
        .villa-card:hover .villa-image {
            transform: scale(1.05);
        }
        
        .villa-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }
        
        .villa-location {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .villa-features {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .villa-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .villa-price {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .villa-guests {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
        
        .villa-category {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .villa-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-primary {
            flex: 1;
            padding: 12px 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: block;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 215, 0, 0.3);
        }
        
        .btn-secondary {
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: white;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error State */
        .error {
            text-align: center;
            padding: 60px 20px;
            color: #ff6b6b;
        }
        
        .error-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        /* Footer */
        .footer {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            text-align: center;
            padding: 40px 20px;
            margin-top: 60px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.2rem;
            }
            
            .search-form {
                grid-template-columns: 1fr;
            }
            
            .villas-grid {
                grid-template-columns: 1fr;
            }
            
            .villa-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .villa-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Video Background -->
    <div class="video-background">
        <video id="backgroundVideo" autoplay muted loop playsinline webkit-playsinline preload="metadata">
            <source src="https://res.cloudinary.com/ddulasmtz/video/upload/v1752950782/background-video.mp4_qoofsz.mp4" type="video/mp4">
        </video>
    </div>
    <div class="video-overlay"></div>
    
    <!-- Header -->
    <header class="header" id="header">
        <div class="header-content">
            <a href="#" class="logo">
                üèñÔ∏è KhanelConcept
            </a>
            
            <nav class="nav-menu">
                <a href="#accueil">Accueil</a>
                <a href="prestataires.html">Prestataires</a>
                <a href="billetterie.html">Billetterie</a>
                <a href="mobilier.html">Mobilier</a>
                <a href="excursions.html">Excursions</a>
                <a href="sos-depannage.html">SOS D√©pannage</a>
                <a href="pmr.html">PMR</a>
                <a href="login.html">Connexion</a>
            </nav>
            
            <div class="mobile-menu-toggle" id="mobileMenuToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>
    
    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <ul class="mobile-menu-items">
            <li><a href="#accueil">Accueil</a></li>
            <li><a href="prestataires.html">Prestataires</a></li>
            <li><a href="billetterie.html">Billetterie</a></li>
            <li><a href="mobilier.html">Mobilier</a></li>
            <li><a href="excursions.html">Excursions</a></li>
            <li><a href="sos-depannage.html">SOS D√©pannage</a></li>
            <li><a href="pmr.html">PMR</a></li>
            <li><a href="login.html">Connexion</a></li>
        </ul>
    </div>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero-section">
            <h1 class="hero-title">Villas de Luxe</h1>
            <p class="hero-subtitle">D√©couvrez nos propri√©t√©s d'exception en Martinique</p>
        </section>
        
        <!-- Search Section -->
        <section class="search-container">
            <div class="search-box glass">
                <!-- API Status -->
                <div id="apiStatus" class="api-status">
                    <span id="statusIcon">‚è≥</span>
                    <span id="statusText">Initialisation de l'API...</span>
                </div>
                
                <form class="search-form" id="searchForm">
                    <div class="form-group">
                        <label for="destination">Destination</label>
                        <select id="destination" name="destination">
                            <option value="">Toutes les destinations</option>
                            <option value="Vauclin">Vauclin</option>
                            <option value="Lamentin">Lamentin</option>
                            <option value="Ste Anne">Ste Anne</option>
                            <option value="Fort-de-France">Fort-de-France</option>
                            <option value="Le Fran√ßois">Le Fran√ßois</option>
                            <option value="Ste Luce">Ste Luce</option>
                            <option value="Trinit√©">Trinit√©</option>
                            <option value="Rivi√®re-Pilote">Rivi√®re-Pilote</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="checkin">Arriv√©e</label>
                        <input type="date" id="checkin" name="checkin">
                    </div>
                    
                    <div class="form-group">
                        <label for="checkout">D√©part</label>
                        <input type="date" id="checkout" name="checkout">
                    </div>
                    
                    <div class="form-group">
                        <label for="guests">Invit√©s</label>
                        <select id="guests" name="guests">
                            <option value="">Nombre d'invit√©s</option>
                            <option value="2">2 personnes</option>
                            <option value="6">6 personnes</option>
                            <option value="10">10 personnes</option>
                            <option value="12">12 personnes</option>
                            <option value="15">15+ personnes</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="category">Cat√©gorie</label>
                        <select id="category" name="category">
                            <option value="">Toutes cat√©gories</option>
                            <option value="sejour">S√©jour</option>
                            <option value="fete">F√™te / Journ√©e</option>
                            <option value="speciale">Sp√©ciales</option>
                        </select>
                    </div>
                </form>
                
                <button class="search-button" id="searchButton">
                    <i class="fas fa-search"></i> Rechercher
                </button>
            </div>
        </section>
        
        <!-- Results Section -->
        <section class="villas-container">
            <h2 class="section-title" id="resultsTitle">Nos Villas de Luxe</h2>
            
            <!-- Loading State -->
            <div id="loadingState" class="loading">
                <div class="loading-spinner"></div>
                <p>Chargement des villas...</p>
            </div>
            
            <!-- Error State -->
            <div id="errorState" class="error" style="display: none;">
                <div class="error-icon">‚ö†Ô∏è</div>
                <h3>Erreur de chargement</h3>
                <p>Impossible de charger les villas. Veuillez r√©essayer.</p>
                <button class="btn-primary" onclick="loadVillas()">R√©essayer</button>
            </div>
            
            <!-- Villa Grid -->
            <div id="villasGrid" class="villas-grid">
                <!-- Les villas seront charg√©es ici dynamiquement -->
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 KhanelConcept - Villas de Luxe Martinique</p>
        <p>D√©velopp√© avec ‚ù§Ô∏è en Martinique</p>
    </footer>
    
    <!-- JavaScript -->
    <script type="module">
        // Import du module fetchData.js
        import { 
            getVillas, 
            getPrestataires, 
            getEvents, 
            getHealth, 
            getStats, 
            getApiConfig,
            clearCache 
        } from './fetchData.js';
        
        // Variables globales
        let currentVillas = [];
        let currentFilters = {};
        
        // √âl√©ments DOM
        const apiStatus = document.getElementById('apiStatus');
        const statusIcon = document.getElementById('statusIcon');
        const statusText = document.getElementById('statusText');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const villasGrid = document.getElementById('villasGrid');
        const resultsTitle = document.getElementById('resultsTitle');
        const searchForm = document.getElementById('searchForm');
        const searchButton = document.getElementById('searchButton');
        
        // Fonction pour mettre √† jour le statut de l'API
        function updateApiStatus(status, message) {
            apiStatus.className = `api-status ${status}`;
            statusText.textContent = message;
            
            switch(status) {
                case 'online':
                    statusIcon.textContent = 'üü¢';
                    break;
                case 'offline':
                    statusIcon.textContent = 'üü°';
                    break;
                case 'error':
                    statusIcon.textContent = 'üî¥';
                    break;
                default:
                    statusIcon.textContent = '‚è≥';
            }
        }
        
        // Fonction pour afficher l'√©tat de chargement
        function showLoadingState() {
            loadingState.style.display = 'block';
            errorState.style.display = 'none';
            villasGrid.style.display = 'none';
        }
        
        // Fonction pour afficher l'√©tat d'erreur
        function showErrorState(error) {
            loadingState.style.display = 'none';
            errorState.style.display = 'block';
            villasGrid.style.display = 'none';
            
            const errorMsg = errorState.querySelector('p');
            errorMsg.textContent = error.message || 'Erreur inconnue';
        }
        
        // Fonction pour afficher les villas
        function showVillas(villas) {
            loadingState.style.display = 'none';
            errorState.style.display = 'none';
            villasGrid.style.display = 'grid';
            
            if (villas.length === 0) {
                villasGrid.innerHTML = `
                    <div class="error" style="grid-column: 1 / -1;">
                        <div class="error-icon">üîç</div>
                        <h3>Aucune villa trouv√©e</h3>
                        <p>Essayez de modifier vos crit√®res de recherche.</p>
                    </div>
                `;
                return;
            }
            
            villasGrid.innerHTML = villas.map(villa => `
                <div class="villa-card glass-strong">
                    <div class="villa-category">${getCategoryName(villa.category)}</div>
                    <img src="${villa.image}" alt="${villa.name}" class="villa-image" 
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNmMGYwZjAiLz48dGV4dCB4PSIxNTAiIHk9IjEwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjQwIiBmaWxsPSIjY2NjIj4ke villa.fallback_icon || 'üèñÔ∏è'}</dGV4dD48L3N2Zz4=';">
                    <div class="villa-content">
                        <h3 class="villa-title">${villa.name}</h3>
                        <p class="villa-location">
                            <i class="fas fa-map-marker-alt"></i>
                            ${villa.location}
                        </p>
                        <p class="villa-features">${villa.features}</p>
                        <div class="villa-details">
                            <div class="villa-price">${villa.price}‚Ç¨</div>
                            <div class="villa-guests">
                                <i class="fas fa-users"></i>
                                ${villa.guests_detail || villa.guests + ' personnes'}
                            </div>
                        </div>
                        <div class="villa-actions">
                            <a href="villa-details.html?id=${villa.id}" class="btn-primary">
                                <i class="fas fa-eye"></i> Voir d√©tails
                            </a>
                            <button class="btn-secondary" onclick="addToWishlist(${villa.id})">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            resultsTitle.textContent = `${villas.length} villa(s) trouv√©e(s)`;
        }
        
        // Fonction pour obtenir le nom de la cat√©gorie
        function getCategoryName(category) {
            const categories = {
                'sejour': 'S√©jour',
                'fete': 'F√™te',
                'speciale': 'Sp√©ciale'
            };
            return categories[category] || category;
        }
        
        // Fonction pour charger les villas
        async function loadVillas(filters = {}) {
            try {
                showLoadingState();
                updateApiStatus('online', 'Chargement des villas...');
                
                const villas = await getVillas(filters);
                currentVillas = villas;
                currentFilters = filters;
                
                showVillas(villas);
                updateApiStatus('online', `${villas.length} villas charg√©es - API op√©rationnelle`);
                
            } catch (error) {
                console.error('Erreur lors du chargement des villas:', error);
                showErrorState(error);
                updateApiStatus('error', `Erreur API: ${error.message}`);
            }
        }
        
        // Fonction pour g√©rer la recherche
        function handleSearch() {
            const formData = new FormData(searchForm);
            const filters = {};
            
            // Destination
            if (formData.get('destination')) {
                filters.location = formData.get('destination');
            }
            
            // Invit√©s
            if (formData.get('guests')) {
                filters.guests = parseInt(formData.get('guests'));
            }
            
            // Cat√©gorie
            if (formData.get('category')) {
                filters.category = formData.get('category');
            }
            
            // Dates (pour le futur)
            if (formData.get('checkin')) {
                filters.checkin = formData.get('checkin');
            }
            if (formData.get('checkout')) {
                filters.checkout = formData.get('checkout');
            }
            
            loadVillas(filters);
        }
        
        // Fonction pour ajouter √† la wishlist
        window.addToWishlist = function(villaId) {
            const villa = currentVillas.find(v => v.id == villaId);
            if (villa) {
                // Simule l'ajout √† la wishlist
                const btn = event.target.closest('.btn-secondary');
                btn.innerHTML = '<i class="fas fa-heart" style="color: red;"></i>';
                btn.style.background = 'rgba(255, 0, 0, 0.2)';
                
                // Notification
                alert(`${villa.name} ajout√©e √† votre wishlist !`);
            }
        };
        
        // Fonction pour v√©rifier la sant√© de l'API
        async function checkApiHealth() {
            try {
                const health = await getHealth();
                const config = getApiConfig();
                
                const message = `API ${health.status} - Mode: ${config.current} - Cache: ${config.cacheSize} items`;
                updateApiStatus(health.status === 'OK' ? 'online' : 'offline', message);
                
            } catch (error) {
                updateApiStatus('error', 'API inaccessible - Mode fallback');
            }
        }
        
        // Gestion des √©v√©nements
        searchButton.addEventListener('click', (e) => {
            e.preventDefault();
            handleSearch();
        });
        
        // Gestion du menu mobile
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        
        mobileMenuToggle.addEventListener('click', () => {
            mobileMenu.classList.toggle('active');
        });
        
        // Fermer le menu mobile en cliquant sur un lien
        const mobileMenuLinks = document.querySelectorAll('.mobile-menu-items a');
        mobileMenuLinks.forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
            });
        });
        
        // Gestion du scroll header
        window.addEventListener('scroll', () => {
            const header = document.getElementById('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ KhanelConcept Jamstack initialis√©');
            
            // V√©rifier la sant√© de l'API
            checkApiHealth();
            
            // Charger les villas
            loadVillas();
            
            // V√©rifier p√©riodiquement la sant√©
            setInterval(checkApiHealth, 30000); // Toutes les 30 secondes
        });
        
        // Gestion iOS video
        function initBackgroundVideoiOS() {
            const video = document.getElementById('backgroundVideo');
            if (video) {
                video.setAttribute('webkit-playsinline', 'true');
                video.setAttribute('playsinline', 'true');
                
                // Gestion pour iOS
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    video.muted = true;
                    video.autoplay = true;
                    
                    // Essayer de jouer au premier touch
                    document.addEventListener('touchstart', function() {
                        video.play().catch(e => console.log('Autoplay prevented:', e));
                    }, { once: true });
                }
            }
        }
        
        // Initialiser la vid√©o
        initBackgroundVideoiOS();
        
        // Exposer les fonctions pour le debugging
        window.khanelDebug = {
            loadVillas,
            checkApiHealth,
            clearCache,
            currentVillas,
            currentFilters,
            getApiConfig
        };
    </script>
</body>
</html>