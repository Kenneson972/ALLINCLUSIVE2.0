<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhanelConcept - Administration</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom Admin CSS -->
    <link href="./css/admin-style.css" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h4><i class="fas fa-villa text-primary me-2"></i>KhanelConcept</h4>
            <p class="text-muted small">Administration</p>
        </div>
        
        <ul class="sidebar-menu">
            <li class="menu-item active" data-section="dashboard">
                <a href="#"><i class="fas fa-chart-dashboard"></i> Dashboard</a>
            </li>
            <li class="menu-item" data-section="villas">
                <a href="#"><i class="fas fa-home"></i> Gestion Villas</a>
            </li>
            <li class="menu-item" data-section="reservations">
                <a href="#"><i class="fas fa-calendar-alt"></i> Réservations</a>
            </li>
            <li class="menu-item" data-section="images">
                <a href="#"><i class="fas fa-images"></i> Galerie Images</a>
            </li>
            <li class="menu-item" data-section="settings">
                <a href="#"><i class="fas fa-cog"></i> Paramètres</a>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <button class="btn btn-outline-danger btn-sm w-100" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Déconnexion
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Header -->
        <header class="admin-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <button class="btn btn-link sidebar-toggle d-lg-none" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 class="mb-0" id="pageTitle">Dashboard</h2>
                </div>
                <div class="d-flex align-items-center">
                    <button class="btn btn-outline-success me-3" onclick="syncWithMainSite()" title="Synchroniser avec le site principal">
                        <i class="fas fa-sync-alt me-1"></i>
                        <span class="d-none d-md-inline">Sync Site</span>
                    </button>
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-2"></i><span id="adminUsername">Admin</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="exportData()">
                                <i class="fas fa-download me-2"></i>Exporter données</a></li>
                            <li><a class="dropdown-item" href="#" onclick="importData()">
                                <i class="fas fa-upload me-2"></i>Importer données</a></li>
                            <li><a class="dropdown-item" href="#" onclick="exportSiteUpdate()">
                                <i class="fas fa-globe me-2"></i>Exporter mise à jour site</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Déconnexion</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content Sections -->
        <div class="content-wrapper p-4">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <div class="row mb-4">
                    <!-- Stats Cards -->
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-primary shadow">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Villas Totales</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalVillas">0</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-home fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-success shadow">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Villas Actives</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="activeVillas">0</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-info shadow">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Réservations</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalReservations">0</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-calendar fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-warning shadow">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Prix Moyen</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800" id="averagePrice">0€</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-euro-sign fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="row">
                    <div class="col-xl-8 col-lg-7">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary">Répartition par Prix</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="priceChart" style="height: 300px;"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-4 col-lg-5">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary">Statut Villas</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="statusChart" style="height: 300px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Activité Récente</h6>
                    </div>
                    <div class="card-body">
                        <div id="recentActivity">
                            <p class="text-muted">Aucune activité récente</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Villas Management Section -->
            <section id="villas-section" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3>Gestion des Villas</h3>
                    <button class="btn btn-primary" onclick="showAddVillaModal()">
                        <i class="fas fa-plus me-2"></i>Ajouter Villa
                    </button>
                </div>

                <!-- Search and Filters -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <input type="text" class="form-control" placeholder="Rechercher villa..." id="villaSearch">
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="statusFilter">
                                    <option value="">Tous les statuts</option>
                                    <option value="active">Actif</option>
                                    <option value="inactive">Inactif</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="priceFilter">
                                    <option value="">Tous les prix</option>
                                    <option value="0-500">0€ - 500€</option>
                                    <option value="500-1000">500€ - 1000€</option>
                                    <option value="1000-1500">1000€ - 1500€</option>
                                    <option value="1500+">1500€+</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-outline-secondary" onclick="clearFilters()">
                                    <i class="fas fa-times"></i> Clear
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Villas Grid -->
                <div class="row" id="villasGrid">
                    <!-- Villas will be loaded here dynamically -->
                </div>
            </section>

            <!-- Reservations Section -->
            <section id="reservations-section" class="content-section">
                <h3>Gestion des Réservations</h3>
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Villa</th>
                                        <th>Client</th>
                                        <th>Dates</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="reservationsTable">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">Aucune réservation trouvée</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Images Section -->
            <section id="images-section" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3>Gestion des Images</h3>
                    <div class="d-flex gap-2">
                        <select class="form-select" id="villaSelector" style="width: 250px;">
                            <option value="">Toutes les villas</option>
                        </select>
                        <button class="btn btn-primary" onclick="imageHandler.importImages()">
                            <i class="fas fa-upload me-2"></i>Importer
                        </button>
                        <button class="btn btn-success" onclick="imageHandler.exportImages()">
                            <i class="fas fa-download me-2"></i>Exporter
                        </button>
                    </div>
                </div>

                <!-- Villa Info Card (when villa selected) -->
                <div id="selectedVillaInfo" class="card mb-4" style="display: none;">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h5 class="card-title mb-1" id="selectedVillaName"></h5>
                                <p class="card-text text-muted mb-2" id="selectedVillaLocation"></p>
                                <p class="card-text" id="selectedVillaDescription"></p>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="villa-price mb-2" id="selectedVillaPrice"></div>
                                <small class="text-muted" id="selectedVillaDetails"></small>
                                <br>
                                <button class="btn btn-outline-primary btn-sm mt-2" onclick="app.editVilla(selectedVillaId)">
                                    <i class="fas fa-edit me-1"></i>Éditer Villa
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                            <h4>Glisser-déposer des images ici</h4>
                            <p class="text-muted">ou cliquer pour sélectionner</p>
                            <p class="small text-info mb-3">
                                <i class="fas fa-info-circle me-1"></i>
                                Sélectionnez une villa ci-dessus pour associer automatiquement les images
                            </p>
                            <input type="file" id="imageUpload" multiple accept="image/*" style="display: none;">
                            <button class="btn btn-primary" onclick="document.getElementById('imageUpload').click()">
                                Sélectionner Images
                            </button>
                        </div>
                        <div class="row mt-4" id="imageGallery">
                            <!-- Images will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="content-section">
                <h3>Paramètres</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Configuration Générale</h5>
                            </div>
                            <div class="card-body">
                                <form id="settingsForm">
                                    <div class="mb-3">
                                        <label class="form-label">Nom du site</label>
                                        <input type="text" class="form-control" id="siteName" value="KhanelConcept">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email de contact</label>
                                        <input type="email" class="form-control" id="contactEmail">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Téléphone</label>
                                        <input type="tel" class="form-control" id="contactPhone">
                                    </div>
                                    <button type="submit" class="btn btn-primary">Sauvegarder</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Données</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" onclick="exportData()">
                                        <i class="fas fa-download me-2"></i>Exporter toutes les données
                                    </button>
                                    <button class="btn btn-warning" onclick="importData()">
                                        <i class="fas fa-upload me-2"></i>Importer données
                                    </button>
                                    <button class="btn btn-danger" onclick="resetData()">
                                        <i class="fas fa-trash me-2"></i>Réinitialiser données
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Villa Modal -->
    <div class="modal fade" id="villaModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="villaModalTitle">Ajouter Villa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="villaForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nom de la villa *</label>
                                    <input type="text" class="form-control" id="villaName" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Prix par nuit (€) *</label>
                                    <input type="number" class="form-control" id="villaPrice" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Capacité *</label>
                                    <input type="number" class="form-control" id="villaCapacity" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Nombre de chambres</label>
                                    <input type="number" class="form-control" id="villaBedrooms">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Nombre de salles de bain</label>
                                    <input type="number" class="form-control" id="villaBathrooms">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Localisation *</label>
                                    <input type="text" class="form-control" id="villaLocation" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Coordonnées GPS</label>
                                    <input type="text" class="form-control" id="villaGPS" placeholder="lat, lng">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Tarif haute saison (€)</label>
                                    <input type="number" class="form-control" id="villaHighSeasonPrice">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Tarif basse saison (€)</label>
                                    <input type="number" class="form-control" id="villaLowSeasonPrice">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Statut</label>
                                    <select class="form-select" id="villaStatus">
                                        <option value="active">Actif</option>
                                        <option value="inactive">Inactif</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" id="villaDescription" rows="4" required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Équipements</label>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-piscine">
                                        <label class="form-check-label">Piscine</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-wifi">
                                        <label class="form-check-label">WiFi</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-climatisation">
                                        <label class="form-check-label">Climatisation</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-vue-mer">
                                        <label class="form-check-label">Vue mer</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-parking">
                                        <label class="form-check-label">Parking</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-cuisine">
                                        <label class="form-check-label">Cuisine équipée</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-terrasse">
                                        <label class="form-check-label">Terrasse</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-barbecue">
                                        <label class="form-check-label">Barbecue</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-jacuzzi">
                                        <label class="form-check-label">Jacuzzi</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-plage">
                                        <label class="form-check-label">Accès plage</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-jardin">
                                        <label class="form-check-label">Jardin</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="amenity-tv">
                                        <label class="form-check-label">Télévision</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Politique d'annulation</label>
                            <textarea class="form-control" id="villaCancellationPolicy" rows="2"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Règles de la maison</label>
                            <textarea class="form-control" id="villaHouseRules" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="saveVilla()" id="saveVillaBtn">
                        <i class="fas fa-save me-2"></i>Sauvegarder
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="successToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-check-circle text-success me-2"></i>
                <strong class="me-auto">Succès</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="successMessage"></div>
        </div>
        <div id="errorToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-exclamation-circle text-danger me-2"></i>
                <strong class="me-auto">Erreur</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="errorMessage"></div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom Scripts -->
    <script src="js/admin-main.js"></script>
    <script src="js/villa-manager.js"></script>
    <script src="js/image-handler.js"></script>
    <script src="js/data-export.js"></script>
    <script src="js/sync-manager.js"></script>
</body>
</html>